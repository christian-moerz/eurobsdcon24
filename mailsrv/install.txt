% pkg install -y cyrus-imapd38 cyrus-sasl cyrus-sasl-saslauthd \
     ca_root_nss redis postfix-sasl amavisd-new clamav \
     clamav-unofficial-sigs spamassassin spamassassin-dqs \
     spamass-milter opendkim spamd amavisd-milter sshguard
Installing pkg-1.21.3...
Extracting pkg-1.21.3: .......... done
Updating FreeBSD repository catalogue...
Fetching meta.conf: . done
Fetching data.pkg: .......... done
Processing entries: .......... done
FreeBSD repository update completed. 34428 packages processed.
All repositories are up to date.
Updating database digests format: . done
The following 24 package(s) will be affected (of 0 checked):

New packages to be INSTALLED:
	cyrus-imapd38: 3.8.3
	cyrus-sasl: 2.1.28_4
	cyrus-sasl-saslauthd: 2.1.28_2
	e2fsprogs-libuuid: 1.47.1
	gettext-runtime: 0.22.5
	glib: 2.80.5,2
	icu: 74.2_1,1
	indexinfo: 0.3.1
	jansson: 2.14
	libedit: 3.1.20240517,1
	libffi: 3.4.6
	libical: 3.0.16_1
	libiconv: 1.17_1
	libsrs2: 1.0.18_4
	libxml2: 2.11.8
	mpdecimal: 4.0.0
	p5-Term-ReadLine-Gnu: 1.46
	pcre: 8.45_4
	pcre2: 10.43
	perl5: 5.36.3_2
	py311-packaging: 24.1
	python311: 3.11.9
	readline: 8.2.10
	sqlite3: 3.46.0,1

Number of packages to be installed: 24

The process will require 439 MiB more space.
71 MiB to be downloaded.
[1/24] Fetching cyrus-sasl-2.1.28_4.pkg: .......... done
[2/24] Fetching indexinfo-0.3.1.pkg: . done
[3/24] Fetching libxml2-2.11.8.pkg: .......... done
[4/24] Fetching mpdecimal-4.0.0.pkg: .......... done
[5/24] Fetching p5-Term-ReadLine-Gnu-1.46.pkg: ........ done
[6/24] Fetching libedit-3.1.20240517,1.pkg: ......... done
[7/24] Fetching icu-74.2_1,1.pkg: .......... done
[8/24] Fetching pcre-8.45_4.pkg: .......... done
[9/24] Fetching sqlite3-3.46.0,1.pkg: .......... done
[10/24] Fetching py311-packaging-24.1.pkg: .......... done
[11/24] Fetching cyrus-sasl-saslauthd-2.1.28_2.pkg: ... done
[12/24] Fetching glib-2.80.5,2.pkg: .......... done
[13/24] Fetching perl5-5.36.3_2.pkg: .......... done
[14/24] Fetching pcre2-10.43.pkg: .......... done
[15/24] Fetching libffi-3.4.6.pkg: .... done
[16/24] Fetching readline-8.2.10.pkg: .......... done
[17/24] Fetching cyrus-imapd38-3.8.3.pkg: .......... done
[18/24] Fetching libsrs2-1.0.18_4.pkg: ..... done
[19/24] Fetching libiconv-1.17_1.pkg: .......... done
[20/24] Fetching libical-3.0.16_1.pkg: .......... done
[21/24] Fetching gettext-runtime-0.22.5.pkg: .......... done
[22/24] Fetching jansson-2.14.pkg: ...... done
[23/24] Fetching e2fsprogs-libuuid-1.47.1.pkg: ... done
[24/24] Fetching python311-3.11.9.pkg: .......... done
Checking integrity... done (0 conflicting)
[1/24] Installing indexinfo-0.3.1...
[1/24] Extracting indexinfo-0.3.1: .... done
[2/24] Installing mpdecimal-4.0.0...
[2/24] Extracting mpdecimal-4.0.0: .......... done
[3/24] Installing libffi-3.4.6...
[3/24] Extracting libffi-3.4.6: .......... done
[4/24] Installing readline-8.2.10...
[4/24] Extracting readline-8.2.10: .......... done
[5/24] Installing gettext-runtime-0.22.5...
[5/24] Extracting gettext-runtime-0.22.5: .......... done
[6/24] Installing python311-3.11.9...
[6/24] Extracting python311-3.11.9: .......... done
[7/24] Installing py311-packaging-24.1...
[7/24] Extracting py311-packaging-24.1: .......... done
[8/24] Installing pcre2-10.43...
[8/24] Extracting pcre2-10.43: .......... done
[9/24] Installing libiconv-1.17_1...
[9/24] Extracting libiconv-1.17_1: .......... done
[10/24] Installing libxml2-2.11.8...
[10/24] Extracting libxml2-2.11.8: .......... done
[11/24] Installing libedit-3.1.20240517,1...
[11/24] Extracting libedit-3.1.20240517,1: .......... done
[12/24] Installing icu-74.2_1,1...
[12/24] Extracting icu-74.2_1,1: .......... done
[13/24] Installing glib-2.80.5,2...
[13/24] Extracting glib-2.80.5,2: .......... done
[14/24] Installing perl5-5.36.3_2...
[14/24] Extracting perl5-5.36.3_2: .......... done
[15/24] Installing cyrus-sasl-2.1.28_4...
*** Added group `cyrus' (id 60)
*** Added user `cyrus' (id 60)
[15/24] Extracting cyrus-sasl-2.1.28_4: .......... done
[16/24] Installing p5-Term-ReadLine-Gnu-1.46...
[16/24] Extracting p5-Term-ReadLine-Gnu-1.46: .......... done
[17/24] Installing pcre-8.45_4...
[17/24] Extracting pcre-8.45_4: .......... done
[18/24] Installing sqlite3-3.46.0,1...
[18/24] Extracting sqlite3-3.46.0,1: .......... done
[19/24] Installing libsrs2-1.0.18_4...
[19/24] Extracting libsrs2-1.0.18_4: .......... done
[20/24] Installing libical-3.0.16_1...
[20/24] Extracting libical-3.0.16_1: .......... done
[21/24] Installing jansson-2.14...
[21/24] Extracting jansson-2.14: .......... done
[22/24] Installing e2fsprogs-libuuid-1.47.1...
[22/24] Extracting e2fsprogs-libuuid-1.47.1: .......... done
[23/24] Installing cyrus-sasl-saslauthd-2.1.28_2...
[23/24] Extracting cyrus-sasl-saslauthd-2.1.28_2: .......... done
[24/24] Installing cyrus-imapd38-3.8.3...
[24/24] Extracting cyrus-imapd38-3.8.3: .......... done
*** Updated user `cyrus'.
sieve		4190/tcp   #ManageSieve Protocol
sieve		4190/udp   #ManageSieve Protocol

==> Running trigger: gio-modules.ucl
Generating GIO modules cache
==> Running trigger: glib-schemas.ucl
Compiling glib schemas
No schema files found: doing nothing.
=====
Message from python311-3.11.9:

--
Note that some standard Python modules are provided as separate ports
as they require additional dependencies. They are available as:

py311-gdbm       databases/py-gdbm@py311
py311-sqlite3    databases/py-sqlite3@py311
py311-tkinter    x11-toolkits/py-tkinter@py311
=====
Message from cyrus-sasl-2.1.28_4:

--
You can use sasldb2 for authentication, to add users use:

	saslpasswd2 -c username

If you want to enable SMTP AUTH with the system Sendmail, read
Sendmail.README

NOTE: This port has been compiled with a default pwcheck_method of
      auxprop.  If you want to authenticate your user by /etc/passwd,
      PAM or LDAP, install ports/security/cyrus-sasl2-saslauthd and
      set sasl_pwcheck_method to saslauthd after installing the
      Cyrus-IMAPd 2.X port.  You should also check the
      /usr/local/lib/sasl2/*.conf files for the correct
      pwcheck_method.
      If you want to use GSSAPI mechanism, install
      ports/security/cyrus-sasl2-gssapi.
      If you want to use SRP mechanism, install
      ports/security/cyrus-sasl2-srp.
      If you want to use LDAP auxprop plugin, install
      ports/security/cyrus-sasl2-ldapdb.
=====
Message from pcre-8.45_4:

--
===>   NOTICE:

This port is deprecated; you may wish to reconsider installing it:

EOLed by upstream, use devel/pcre2 instead.
=====
Message from cyrus-sasl-saslauthd-2.1.28_2:

--
To run saslauthd from startup, add saslauthd_enable="YES" in your
/etc/rc.conf.
=====
Message from cyrus-imapd38-3.8.3:

--
To setup mail spool, modify /usr/local/etc/imapd.conf appropriately,
then run /usr/local/cyrus/sbin/mkimap.
To run Cyrus IMAPd from startup, add cyrus_imapd_enable="YES" in your
/etc/rc.conf.
Updating FreeBSD repository catalogue...
FreeBSD repository is up to date.
All repositories are up to date.
The following 2 package(s) will be affected (of 0 checked):

New packages to be INSTALLED:
	ca_root_nss: 3.93_2
	redis: 7.2.5

Number of packages to be installed: 2

The process will require 9 MiB more space.
1 MiB to be downloaded.
[1/2] Fetching ca_root_nss-3.93_2.pkg: .......... done
[2/2] Fetching redis-7.2.5.pkg: .......... done
Checking integrity... done (0 conflicting)
[1/2] Installing ca_root_nss-3.93_2...
[1/2] Extracting ca_root_nss-3.93_2: ....... done
Scanning /usr/share/certs/untrusted for certificates...
Scanning /usr/share/certs/trusted for certificates...
Scanning /usr/local/share/certs for certificates...
[2/2] Installing redis-7.2.5...
===> Creating groups
Creating group 'redis' with gid '535'
===> Creating users
Creating user 'redis' with uid '535'
[2/2] Extracting redis-7.2.5: ......... done
=====
Message from ca_root_nss-3.93_2:

--
FreeBSD does not, and can not warrant that the certification authorities
whose certificates are included in this package have in any way been
audited for trustworthiness or RFC 3647 compliance.

Assessment and verification of trust is the complete responsibility of
the system administrator.

This package installs symlinks to support root certificate discovery
for software that either uses other cryptographic libraries than
OpenSSL, or use OpenSSL but do not follow recommended practice.

If you prefer to do this manually, replace the following symlinks with
either an empty file or your site-local certificate bundle.

  * /etc/ssl/cert.pem
  * /usr/local/etc/ssl/cert.pem
  * /usr/local/openssl/cert.pem
=====
Message from redis-7.2.5:

--
To setup "redis" you need to edit the configuration file:
      /usr/local/etc/redis.conf

      To run redis from startup, add redis_enable="YES"
      in your /etc/rc.conf.
Updating FreeBSD repository catalogue...
FreeBSD repository is up to date.
All repositories are up to date.
The following 1 package(s) will be affected (of 0 checked):

New packages to be INSTALLED:
	postfix-sasl: 3.9.0_1,1

Number of packages to be installed: 1

The process will require 8 MiB more space.
2 MiB to be downloaded.
[1/1] Fetching postfix-sasl-3.9.0_1,1.pkg: .......... done
Checking integrity... done (0 conflicting)
[1/1] Installing postfix-sasl-3.9.0_1,1...
===> Creating groups
Using existing group 'mail'
Creating group 'maildrop' with gid '126'
Creating group 'postfix' with gid '125'
===> Creating users
Creating user 'postfix' with uid '125'
===> Creating homedir(s)
Adding user 'postfix' to group 'mail'
[1/1] Extracting postfix-sasl-3.9.0_1,1: .......... done

===============================================================
Postfix was *not* activated in /usr/local/etc/mail/mailer.conf! 

To finish installation run the following commands:

  mkdir -p /usr/local/etc/mail
  install -m 0644 /usr/local/share/postfix/mailer.conf.postfix /usr/local/etc/mail/mailer.conf
===============================================================

=====
Message from postfix-sasl-3.9.0_1,1:

--
To use postfix instead of sendmail:
  - clear sendmail queue and stop the sendmail daemons

Run the following commands to enable postfix during startup:
  - sysrc postfix_enable="YES"
  - sysrc sendmail_enable="NONE"

If postfix is *not* already activated in /usr/local/etc/mail/mailer.conf
  - mv /usr/local/etc/mail/mailer.conf /usr/local/etc/mail/mailer.conf.old
  - install -d /usr/local/etc/mail
  - install -m 0644 /usr/local/share/postfix/mailer.conf.postfix /usr/local/etc/mail/mailer.conf

Disable sendmail(8) specific tasks,
add the following lines to /etc/periodic.conf(.local):
  daily_clean_hoststat_enable="NO"
  daily_status_mail_rejects_enable="NO"
  daily_status_include_submit_mailq="NO"
  daily_submit_queuerun="NO"

If you are using SASL, you need to make sure that postfix has access to read
the sasldb file.  This is accomplished by adding postfix to group mail and
making the /usr/local/etc/sasldb* file(s) readable by group mail (this should
be the default for new installs).
Updating FreeBSD repository catalogue...
FreeBSD repository is up to date.
All repositories are up to date.
The following 104 package(s) will be affected (of 0 checked):

New packages to be INSTALLED:
	7-zip: 24.07
	amavisd-milter: 1.7.0_1
	amavisd-new: 2.12.3_3,1
	arc: 5.21q_1
	arj: 3.10.22_12
	bash: 5.2.26_1
	cabextract: 1.11_1
	clamav: 1.3.2,1
	clamav-unofficial-sigs: 7.2.5_3
	curl: 8.9.1_1
	db5: 5.3.28_9
	expat: 2.6.2
	file: 5.39_1
	gmp: 6.3.0
	gnupg: 2.4.5
	gnupg1: 1.4.23_4
	gnutls: 3.8.5_3
	gsed: 4.9
	json-c: 0.17
	libassuan: 2.5.7
	libevent: 2.1.12
	libgcrypt: 1.11.0
	libgpg-error: 1.50
	libidn: 1.42
	libidn2: 2.3.7
	libksba: 1.6.6
	liblz4: 1.9.4_1,1
	libmspack: 0.11alpha
	libnghttp2: 1.62.1
	libpsl: 0.21.5_1
	libsodium: 1.0.19
	libssh2: 1.11.0_1,3
	libsysinfo: 0.0.3_3
	libtasn1: 4.19.0_1
	libunistring: 1.2
	lua54: 5.4.6_1
	lzo2: 2.10_1
	lzop: 1.04_1
	nettle: 3.10_1
	npth: 1.7
	opendkim: 2.10.3_20
	p11-kit: 0.25.3_2
	p5-Archive-Zip: 1.68
	p5-BerkeleyDB: 0.65
	p5-Class-XSAccessor: 1.19_2,1
	p5-Clone: 0.46
	p5-Convert-BinHex: 1.125
	p5-Convert-TNEF: 0.18_2
	p5-Convert-UUlib: 1.70,1
	p5-Crypt-OpenSSL-Bignum: 0.09
	p5-Crypt-OpenSSL-RSA: 0.33
	p5-Crypt-OpenSSL-Random: 0.17
	p5-CryptX: 0.080
	p5-Digest-HMAC: 1.04
	p5-Encode-Detect: 1.01_1
	p5-Encode-Locale: 1.05
	p5-Error: 0.17029
	p5-HTML-Parser: 3.82
	p5-HTML-Tagset: 3.24
	p5-HTTP-Date: 6.06
	p5-HTTP-Message: 6.46
	p5-IO-HTML: 1.004
	p5-IO-Multiplex: 1.16
	p5-IO-Socket-INET6: 2.73
	p5-IO-Socket-IP: 0.42
	p5-IO-Socket-SSL: 2.085_1
	p5-IO-Stringy: 2.113
	p5-JSON: 4.10
	p5-LWP-MediaTypes: 6.04
	p5-MIME-Tools: 5.515,2
	p5-Mail-AuthenticationResults: 2.20231031
	p5-Mail-DKIM: 1.20240619
	p5-Mail-SPF: 3.20240617
	p5-Mail-Tools: 2.21
	p5-Mozilla-CA: 20240730
	p5-Net-CIDR-Lite: 0.22
	p5-Net-DNS: 1.45,1
	p5-Net-IDN-Encode: 2.500
	p5-Net-LibIDN: 0.12_6
	p5-Net-SSLeay: 1.94
	p5-Net-Server: 2.014
	p5-NetAddr-IP: 4.079
	p5-Socket6: 0.29
	p5-TimeDate: 2.33,1
	p5-URI: 5.28
	p5-Unix-Syslog: 1.1_1
	p5-XString: 0.005
	p5-common-sense: 3.75
	pinentry: 1.3.0
	pinentry-curses: 1.3.0
	re2c: 3.0
	ripole: 0.2.2
	rpm2cpio: 1.4_2
	rsync: 3.3.0
	spamass-milter: 0.4.0_5
	spamassassin: 4.0.1_1
	spamassassin-dqs: 1.5.1_1
	spamd: 4.9.1_7
	unbound: 1.21.0
	unrar: 7.01,6
	unzoo: 4.4_2
	xxhash: 0.8.2_1
	zoo: 2.10.1_5
	zstd: 1.5.6

Number of packages to be installed: 104

The process will require 232 MiB more space.
54 MiB to be downloaded.
[1/104] Fetching p5-Net-SSLeay-1.94.pkg: .......... done
[2/104] Fetching unbound-1.21.0.pkg: .......... done
[3/104] Fetching pinentry-curses-1.3.0.pkg: ...... done
[4/104] Fetching p5-IO-Socket-IP-0.42.pkg: ..... done
[5/104] Fetching p5-URI-5.28.pkg: .......... done
[6/104] Fetching p5-Crypt-OpenSSL-RSA-0.33.pkg: ... done
[7/104] Fetching libidn2-2.3.7.pkg: ......... done
[8/104] Fetching p5-Crypt-OpenSSL-Random-0.17.pkg: .... done
[9/104] Fetching spamassassin-dqs-1.5.1_1.pkg: .. done
[10/104] Fetching spamassassin-4.0.1_1.pkg: ......... done
[11/104] Fetching nettle-3.10_1.pkg: .......... done
[12/104] Fetching lzo2-2.10_1.pkg: .......... done
[13/104] Fetching lua54-5.4.6_1.pkg: .......... done
[14/104] Fetching libunistring-1.2.pkg: .......... done
[15/104] Fetching p5-NetAddr-IP-4.079.pkg: ...... done
[16/104] Fetching p5-Unix-Syslog-1.1_1.pkg: .... done
[17/104] Fetching p5-TimeDate-2.33,1.pkg: ... done
[18/104] Fetching npth-1.7.pkg: ... done
[19/104] Fetching json-c-0.17.pkg: ..... done
[20/104] Fetching p5-Error-0.17029.pkg: .. done
[21/104] Fetching libmspack-0.11alpha.pkg: ...... done
[22/104] Fetching libidn-1.42.pkg: .......... done
[23/104] Fetching p5-Convert-TNEF-0.18_2.pkg: .... done
[24/104] Fetching libtasn1-4.19.0_1.pkg: .......... done
[25/104] Fetching amavisd-milter-1.7.0_1.pkg: ..... done
[26/104] Fetching gnupg1-1.4.23_4.pkg: .......... done
[27/104] Fetching spamass-milter-0.4.0_5.pkg: ......... done
[28/104] Fetching zoo-2.10.1_5.pkg: ........ done
[29/104] Fetching libnghttp2-1.62.1.pkg: .......... done
[30/104] Fetching p5-HTTP-Date-6.06.pkg: .. done
[31/104] Fetching p5-Mail-DKIM-1.20240619.pkg: ......... done
[32/104] Fetching libksba-1.6.6.pkg: .......... done
[33/104] Fetching lzop-1.04_1.pkg: ........ done
[34/104] Fetching db5-5.3.28_9.pkg: .......... done
[35/104] Fetching gnutls-3.8.5_3.pkg: .......... done
[36/104] Fetching p5-IO-Socket-INET6-2.73.pkg: ... done
[37/104] Fetching p5-Net-DNS-1.45,1.pkg: .......... done
[38/104] Fetching pinentry-1.3.0.pkg: ..... done
[39/104] Fetching p5-Encode-Locale-1.05.pkg: ... done
[40/104] Fetching p5-HTML-Parser-3.82.pkg: .......... done
[41/104] Fetching cabextract-1.11_1.pkg: .... done
[42/104] Fetching p5-LWP-MediaTypes-6.04.pkg: ..... done
[43/104] Fetching xxhash-0.8.2_1.pkg: ......... done
[44/104] Fetching p5-IO-HTML-1.004.pkg: ...... done
[45/104] Fetching p5-Digest-HMAC-1.04.pkg: ..... done
[46/104] Fetching libpsl-0.21.5_1.pkg: .......... done
[47/104] Fetching bash-5.2.26_1.pkg: .......... done
[48/104] Fetching clamav-1.3.2,1.pkg: .......... done
[49/104] Fetching arj-3.10.22_12.pkg: ......... done
[50/104] Fetching p5-HTTP-Message-6.46.pkg: ..... done
[51/104] Fetching libevent-2.1.12.pkg: .......... done
[52/104] Fetching arc-5.21q_1.pkg: .... done
[53/104] Fetching unrar-7.01,6.pkg: ........ done
[54/104] Fetching p5-Crypt-OpenSSL-Bignum-0.09.pkg: .... done
[55/104] Fetching p5-Net-Server-2.014.pkg: ........ done
[56/104] Fetching p5-IO-Socket-SSL-2.085_1.pkg: ...... done
[57/104] Fetching ripole-0.2.2.pkg: ... done
[58/104] Fetching p5-IO-Multiplex-1.16.pkg: ... done
[59/104] Fetching libassuan-2.5.7.pkg: ..... done
[60/104] Fetching p5-IO-Stringy-2.113.pkg: ....... done
[61/104] Fetching rsync-3.3.0.pkg: .......... done
[62/104] Fetching liblz4-1.9.4_1,1.pkg: .......... done
[63/104] Fetching p5-Mail-SPF-3.20240617.pkg: .... done
[64/104] Fetching libgcrypt-1.11.0.pkg: .......... done
[65/104] Fetching p5-Convert-BinHex-1.125.pkg: ...... done
[66/104] Fetching amavisd-new-2.12.3_3,1.pkg: .......... done
[67/104] Fetching p5-Net-IDN-Encode-2.500.pkg: ........ done
[68/104] Fetching clamav-unofficial-sigs-7.2.5_3.pkg: ........ done
[69/104] Fetching zstd-1.5.6.pkg: .......... done
[70/104] Fetching p5-Clone-0.46.pkg: .... done
[71/104] Fetching libgpg-error-1.50.pkg: .......... done
[72/104] Fetching curl-8.9.1_1.pkg: .......... done
[73/104] Fetching gmp-6.3.0.pkg: .......... done
[74/104] Fetching p5-CryptX-0.080.pkg: .......... done
[75/104] Fetching p5-HTML-Tagset-3.24.pkg: ... done
[76/104] Fetching gsed-4.9.pkg: .......... done
[77/104] Fetching p5-XString-0.005.pkg: .. done
[78/104] Fetching p5-Mail-Tools-2.21.pkg: ........ done
[79/104] Fetching p5-Archive-Zip-1.68.pkg: ...... done
[80/104] Fetching gnupg-2.4.5.pkg: .......... done
[81/104] Fetching file-5.39_1.pkg: .......... done
[82/104] Fetching p5-Encode-Detect-1.01_1.pkg: ........ done
[83/104] Fetching p5-MIME-Tools-5.515,2.pkg: ........ done
[84/104] Fetching p11-kit-0.25.3_2.pkg: .......... done
[85/104] Fetching p5-Mail-AuthenticationResults-2.20231031.pkg: ....... done
[86/104] Fetching libsysinfo-0.0.3_3.pkg: ...... done
[87/104] Fetching re2c-3.0.pkg: ......... done
[88/104] Fetching p5-BerkeleyDB-0.65.pkg: ....... done
[89/104] Fetching p5-Socket6-0.29.pkg: .. done
[90/104] Fetching opendkim-2.10.3_20.pkg: .......... done
[91/104] Fetching p5-Net-CIDR-Lite-0.22.pkg: . done
[92/104] Fetching libsodium-1.0.19.pkg: ......... done
[93/104] Fetching p5-JSON-4.10.pkg: ...... done
[94/104] Fetching p5-Class-XSAccessor-1.19_2,1.pkg: .... done
[95/104] Fetching p5-Mozilla-CA-20240730.pkg: ...... done
[96/104] Fetching p5-Net-LibIDN-0.12_6.pkg: ... done
[97/104] Fetching p5-Convert-UUlib-1.70,1.pkg: ......... done
[98/104] Fetching libssh2-1.11.0_1,3.pkg: ......... done
[99/104] Fetching p5-common-sense-3.75.pkg: .. done
[100/104] Fetching unzoo-4.4_2.pkg: .... done
[101/104] Fetching expat-2.6.2.pkg: ....... done
[102/104] Fetching spamd-4.9.1_7.pkg: .... done
[103/104] Fetching rpm2cpio-1.4_2.pkg: . done
[104/104] Fetching 7-zip-24.07.pkg: .......... done
Checking integrity... done (0 conflicting)
[1/104] Installing libunistring-1.2...
[1/104] Extracting libunistring-1.2: .......... done
[2/104] Installing libidn2-2.3.7...
[2/104] Extracting libidn2-2.3.7: .......... done
[3/104] Installing p5-TimeDate-2.33,1...
[3/104] Extracting p5-TimeDate-2.33,1: .......... done
[4/104] Installing p5-URI-5.28...
[4/104] Extracting p5-URI-5.28: .......... done
[5/104] Installing p5-Crypt-OpenSSL-Random-0.17...
[5/104] Extracting p5-Crypt-OpenSSL-Random-0.17: ........ done
[6/104] Installing libnghttp2-1.62.1...
[6/104] Extracting libnghttp2-1.62.1: .......... done
[7/104] Installing p5-HTTP-Date-6.06...
[7/104] Extracting p5-HTTP-Date-6.06: ....... done
[8/104] Installing p5-Encode-Locale-1.05...
[8/104] Extracting p5-Encode-Locale-1.05: ....... done
[9/104] Installing p5-LWP-MediaTypes-6.04...
[9/104] Extracting p5-LWP-MediaTypes-6.04: ........ done
[10/104] Installing p5-IO-HTML-1.004...
[10/104] Extracting p5-IO-HTML-1.004: ....... done
[11/104] Installing p5-Digest-HMAC-1.04...
[11/104] Extracting p5-Digest-HMAC-1.04: .......... done
[12/104] Installing libpsl-0.21.5_1...
[12/104] Extracting libpsl-0.21.5_1: .......... done
[13/104] Installing p5-Crypt-OpenSSL-Bignum-0.09...
[13/104] Extracting p5-Crypt-OpenSSL-Bignum-0.09: .......... done
[14/104] Installing p5-Clone-0.46...
[14/104] Extracting p5-Clone-0.46: ......... done
[15/104] Installing libgpg-error-1.50...
[15/104] Extracting libgpg-error-1.50: .......... done
[16/104] Installing p5-JSON-4.10...
[16/104] Extracting p5-JSON-4.10: .......... done
[17/104] Installing libssh2-1.11.0_1,3...
[17/104] Extracting libssh2-1.11.0_1,3: .......... done
[18/104] Installing p5-Net-SSLeay-1.94...
[18/104] Extracting p5-Net-SSLeay-1.94: .......... done
[19/104] Installing p5-IO-Socket-IP-0.42...
[19/104] Extracting p5-IO-Socket-IP-0.42: ....... done
[20/104] Installing p5-Crypt-OpenSSL-RSA-0.33...
[20/104] Extracting p5-Crypt-OpenSSL-RSA-0.33: .......... done
[21/104] Installing p5-NetAddr-IP-4.079...
[21/104] Extracting p5-NetAddr-IP-4.079: .......... done
[22/104] Installing p5-Error-0.17029...
[22/104] Extracting p5-Error-0.17029: ......... done
[23/104] Installing libidn-1.42...
[23/104] Extracting libidn-1.42: .......... done
[24/104] Installing libtasn1-4.19.0_1...
[24/104] Extracting libtasn1-4.19.0_1: .......... done
[25/104] Installing p5-Net-DNS-1.45,1...
[25/104] Extracting p5-Net-DNS-1.45,1: .......... done
[26/104] Installing p5-HTTP-Message-6.46...
[26/104] Extracting p5-HTTP-Message-6.46: .......... done
[27/104] Installing libassuan-2.5.7...
[27/104] Extracting libassuan-2.5.7: .......... done
[28/104] Installing p5-Convert-BinHex-1.125...
[28/104] Extracting p5-Convert-BinHex-1.125: .......... done
[29/104] Installing curl-8.9.1_1...
[29/104] Extracting curl-8.9.1_1: .......... done
[30/104] Installing gmp-6.3.0...
[30/104] Extracting gmp-6.3.0: .......... done
[31/104] Installing p5-CryptX-0.080...
[31/104] Extracting p5-CryptX-0.080: .......... done
[32/104] Installing p5-HTML-Tagset-3.24...
[32/104] Extracting p5-HTML-Tagset-3.24: ....... done
[33/104] Installing p5-Mail-Tools-2.21...
[33/104] Extracting p5-Mail-Tools-2.21: .......... done
[34/104] Installing p5-Mail-AuthenticationResults-2.20231031...
[34/104] Extracting p5-Mail-AuthenticationResults-2.20231031: .......... done
[35/104] Installing p5-Socket6-0.29...
[35/104] Extracting p5-Socket6-0.29: ....... done
[36/104] Installing p5-Mozilla-CA-20240730...
[36/104] Extracting p5-Mozilla-CA-20240730: ....... done
[37/104] Installing pinentry-curses-1.3.0...
[37/104] Extracting pinentry-curses-1.3.0: .... done
[38/104] Installing nettle-3.10_1...
[38/104] Extracting nettle-3.10_1: .......... done
[39/104] Installing lzo2-2.10_1...
[39/104] Extracting lzo2-2.10_1: .......... done
[40/104] Installing gnupg1-1.4.23_4...
[40/104] Extracting gnupg1-1.4.23_4: .......... done
[41/104] Installing p5-Mail-DKIM-1.20240619...
[41/104] Extracting p5-Mail-DKIM-1.20240619: .......... done
[42/104] Installing db5-5.3.28_9...
[42/104] Extracting db5-5.3.28_9: .......... done
[43/104] Installing p5-IO-Socket-INET6-2.73...
[43/104] Extracting p5-IO-Socket-INET6-2.73: ....... done
[44/104] Installing p5-HTML-Parser-3.82...
[44/104] Extracting p5-HTML-Parser-3.82: .......... done
[45/104] Installing p5-IO-Socket-SSL-2.085_1...
[45/104] Extracting p5-IO-Socket-SSL-2.085_1: .......... done
[46/104] Installing p5-IO-Multiplex-1.16...
[46/104] Extracting p5-IO-Multiplex-1.16: ....... done
[47/104] Installing p5-IO-Stringy-2.113...
[47/104] Extracting p5-IO-Stringy-2.113: .......... done
[48/104] Installing liblz4-1.9.4_1,1...
[48/104] Extracting liblz4-1.9.4_1,1: .......... done
[49/104] Installing p5-Mail-SPF-3.20240617...
[49/104] Extracting p5-Mail-SPF-3.20240617: .......... done
[50/104] Installing p5-Net-IDN-Encode-2.500...
[50/104] Extracting p5-Net-IDN-Encode-2.500: .......... done
[51/104] Installing p5-XString-0.005...
[51/104] Extracting p5-XString-0.005: ........ done
[52/104] Installing p5-Encode-Detect-1.01_1...
[52/104] Extracting p5-Encode-Detect-1.01_1: ......... done
[53/104] Installing p5-MIME-Tools-5.515,2...
[53/104] Extracting p5-MIME-Tools-5.515,2: .......... done
[54/104] Installing p11-kit-0.25.3_2...
[54/104] Extracting p11-kit-0.25.3_2: .......... done
[55/104] Installing libsysinfo-0.0.3_3...
[55/104] Extracting libsysinfo-0.0.3_3: ......... done
[56/104] Installing re2c-3.0...
[56/104] Extracting re2c-3.0: .......... done
[57/104] Installing p5-Net-CIDR-Lite-0.22...
[57/104] Extracting p5-Net-CIDR-Lite-0.22: ....... done
[58/104] Installing p5-Class-XSAccessor-1.19_2,1...
[58/104] Extracting p5-Class-XSAccessor-1.19_2,1: .......... done
[59/104] Installing p5-Net-LibIDN-0.12_6...
[59/104] Extracting p5-Net-LibIDN-0.12_6: ......... done
[60/104] Installing p5-common-sense-3.75...
[60/104] Extracting p5-common-sense-3.75: ........ done
[61/104] Installing spamassassin-4.0.1_1...
===> Creating groups
Creating group 'spamd' with gid '58'
===> Creating users
Creating user 'spamd' with uid '58'
===> Creating homedir(s)
[61/104] Extracting spamassassin-4.0.1_1: .......... done
[62/104] Installing p5-Unix-Syslog-1.1_1...
[62/104] Extracting p5-Unix-Syslog-1.1_1: ....... done
[63/104] Installing npth-1.7...
[63/104] Extracting npth-1.7: ......... done
[64/104] Installing json-c-0.17...
[64/104] Extracting json-c-0.17: .......... done
[65/104] Installing libmspack-0.11alpha...
[65/104] Extracting libmspack-0.11alpha: ......... done
[66/104] Installing p5-Convert-TNEF-0.18_2...
[66/104] Extracting p5-Convert-TNEF-0.18_2: ....... done
[67/104] Installing zoo-2.10.1_5...
[67/104] Extracting zoo-2.10.1_5: .... done
[68/104] Installing libksba-1.6.6...
[68/104] Extracting libksba-1.6.6: .......... done
[69/104] Installing lzop-1.04_1...
[69/104] Extracting lzop-1.04_1: .......... done
[70/104] Installing gnutls-3.8.5_3...
[70/104] Extracting gnutls-3.8.5_3: .......... done
[71/104] Installing pinentry-1.3.0...
[71/104] Extracting pinentry-1.3.0: ..... done
[72/104] Installing cabextract-1.11_1...
[72/104] Extracting cabextract-1.11_1: .......... done
[73/104] Installing xxhash-0.8.2_1...
[73/104] Extracting xxhash-0.8.2_1: .......... done
[74/104] Installing arj-3.10.22_12...
[74/104] Extracting arj-3.10.22_12: .......... done
[75/104] Installing libevent-2.1.12...
[75/104] Extracting libevent-2.1.12: .......... done
[76/104] Installing arc-5.21q_1...
[76/104] Extracting arc-5.21q_1: ....... done
[77/104] Installing unrar-7.01,6...
[77/104] Extracting unrar-7.01,6: .... done
[78/104] Installing p5-Net-Server-2.014...
[78/104] Extracting p5-Net-Server-2.014: .......... done
[79/104] Installing ripole-0.2.2...
[79/104] Extracting ripole-0.2.2: . done
[80/104] Installing libgcrypt-1.11.0...
[80/104] Extracting libgcrypt-1.11.0: .......... done
[81/104] Installing zstd-1.5.6...
[81/104] Extracting zstd-1.5.6: .......... done
[82/104] Installing p5-Archive-Zip-1.68...
[82/104] Extracting p5-Archive-Zip-1.68: .......... done
[83/104] Installing file-5.39_1...
[83/104] Extracting file-5.39_1: .......... done
[84/104] Installing p5-BerkeleyDB-0.65...
[84/104] Extracting p5-BerkeleyDB-0.65: .......... done
[85/104] Installing libsodium-1.0.19...
[85/104] Extracting libsodium-1.0.19: .......... done
[86/104] Installing p5-Convert-UUlib-1.70,1...
[86/104] Extracting p5-Convert-UUlib-1.70,1: ........ done
[87/104] Installing unzoo-4.4_2...
[87/104] Extracting unzoo-4.4_2: ..... done
[88/104] Installing expat-2.6.2...
[88/104] Extracting expat-2.6.2: .......... done
[89/104] Installing rpm2cpio-1.4_2...
[89/104] Extracting rpm2cpio-1.4_2: ..... done
[90/104] Installing 7-zip-24.07...
[90/104] Extracting 7-zip-24.07: .......... done
[91/104] Installing unbound-1.21.0...
===> Creating groups
Using existing group 'unbound'
===> Creating users
Using existing user 'unbound'
[91/104] Extracting unbound-1.21.0: .......... done
[92/104] Installing lua54-5.4.6_1...
[92/104] Extracting lua54-5.4.6_1: .......... done
[93/104] Installing bash-5.2.26_1...
[93/104] Extracting bash-5.2.26_1: .......... done
[94/104] Installing clamav-1.3.2,1...
===> Creating groups
Creating group 'clamav' with gid '106'
Using existing group 'mail'
===> Creating users
Creating user 'clamav' with uid '106'
Adding user 'clamav' to group 'mail'
[94/104] Extracting clamav-1.3.2,1: .......... done
[95/104] Installing rsync-3.3.0...
[95/104] Extracting rsync-3.3.0: .......... done
[96/104] Installing amavisd-new-2.12.3_3,1...
===> Creating groups
Creating group 'vscan' with gid '110'
===> Creating users
Creating user 'vscan' with uid '110'
===> Creating homedir(s)
[96/104] Extracting amavisd-new-2.12.3_3,1: .......... done
[97/104] Installing gsed-4.9...
[97/104] Extracting gsed-4.9: .......... done
[98/104] Installing gnupg-2.4.5...
[98/104] Extracting gnupg-2.4.5: .......... done
[99/104] Installing spamassassin-dqs-1.5.1_1...
[99/104] Extracting spamassassin-dqs-1.5.1_1: ...... done
[100/104] Installing amavisd-milter-1.7.0_1...
[100/104] Extracting amavisd-milter-1.7.0_1: ....... done
[101/104] Installing spamass-milter-0.4.0_5...
[101/104] Extracting spamass-milter-0.4.0_5: .......... done
[102/104] Installing clamav-unofficial-sigs-7.2.5_3...
[102/104] Extracting clamav-unofficial-sigs-7.2.5_3: .......... done
[103/104] Installing opendkim-2.10.3_20...
[103/104] Extracting opendkim-2.10.3_20: .......... done
[104/104] Installing spamd-4.9.1_7...
===> Creating groups
Creating group '_spamd' with gid '132'
===> Creating users
Creating user '_spamd' with uid '132'
[104/104] Extracting spamd-4.9.1_7: .......... done
=====
Message from db5-5.3.28_9:

--
===>   NOTICE:

The db5 port currently does not have a maintainer. As a result, it is
more likely to have unresolved issues, not be up-to-date, or even be removed in
the future. To volunteer to maintain this port, please create an issue at:

https://bugs.freebsd.org/bugzilla

More information about port maintainership is available at:

https://docs.freebsd.org/en/articles/contributing/#ports-contributing
--
===>   NOTICE:

This port is deprecated; you may wish to reconsider installing it:

EOLd, potential security issues, maybe use db18 instead.

It is scheduled to be removed on or after 2022-06-30.
=====
Message from spamassassin-4.0.1_1:

--
You should complete the following post-installation tasks:

	1) Read /usr/local/share/doc/spamassassin/INSTALL
	   and /usr/local/share/doc/spamassassin/UPGRADE
	   BEFORE enabling SpamAssassin for important changes

	2) Edit the configuration in /usr/local/etc/mail/spamassassin,
	   in particular /usr/local/etc/mail/spamassassin/init.pre
	   You may get lots of annoying (but harmless) error messages
	   if you skip this step.

	3) To run spamd, add the following to /etc/rc.conf:
	   spamd_enable="YES"

        4) If this is a new installation, you should run sa-update
           and sa-compile. If this isn't a new installation, you
           should run those commands immediately after update and
           probably run them on a regular basis.

	5) Install mail/spamass-rules if you want some third-party
	   spam-catching rulesets

        6) Remove /usr/local/etc/mail/spamassassin/sa-update-keys if this software is no
           longer needed.

SECURITY NOTE:
By default, spamd runs as root (the AS_ROOT option). If you wish
to change this, add the following to /etc/rc.conf:

	spamd_flags="-u spamd -H /var/spool/spamd"
=====
Message from zoo-2.10.1_5:

--
===>   NOTICE:

The zoo port currently does not have a maintainer. As a result, it is
more likely to have unresolved issues, not be up-to-date, or even be removed in
the future. To volunteer to maintain this port, please create an issue at:

https://bugs.freebsd.org/bugzilla

More information about port maintainership is available at:

https://docs.freebsd.org/en/articles/contributing/#ports-contributing
=====
Message from rsync-3.3.0:

--
Some scripts provided by rsync, such as rrsync,
require Python, which is not installed by default.
=====
Message from amavisd-new-2.12.3_3,1:

--
To use amavisd-new, you need to install at least one virus scanner.
 The following virus scanners are available in the FreeBSD ports
 collection:

 /usr/ports/security/clamav	Clam Antivirus
 /usr/ports/security/f-prot	F-Prot Antivirus

 Enable amavisd-new in /etc/rc.conf with the following line:

    amavisd_enable="YES"

 You can set the pidfile, if you do not use the default path:

    amavisd_pidfile="/var/amavis/amavisd.pid"

 Optionally enable amavisd tmp ram disk with:

    amavisd_ram="512m"

 If you have installed and want to use the amavis sendmail milter interface,
 you need the following additional line in /etc/rc.conf:

    amavis_milter_enable="YES"

 If you have installed and want to use the p0fanalyzer interface,
 you need the following additional lines in /etc/rc.conf
 (with modifications according to your needs):

    amavis_p0fanalyzer_enable="YES"
    amavis_p0fanalyzer_p0f_filter="tcp dst port 25"

 You can pass another command line options to p0f daemon by setting
 amavis_p0f_daemon_flags and to p0f-analyzer.pl by setting
 amavis_p0fanalyzer_flags.

 Configuration templates are available in /usr/local/etc
 as amavisd.conf.sample, amavisd.conf-default and amavisd-custom.conf.sample
 Documentation is available in /usr/local/share/doc/amavisd-new.
=====
Message from spamassassin-dqs-1.5.1_1:

--
you will need to configure the sh.cf file with your own
DQS key.   

Follow the instructions at:
https://www.spamhaustech.com/dqs/
to get a key, then go to:
https://portal.spamhaustech.com/manuals/dqs/
and note the DQS key under section "1.0 Datafeed Query Service".

Once you have it, run the following as root:

cd /usr/local/etc/mail/spamassassin
sed -e 's/your_DQS_key/<your key from above>/g' sh.cf.sample >sh.cf

if the HBL option is selected, issue the following as well:
sed -e 's/your_DQS_key/<your key from above>/g' sh_hbl.cf.sample >sh_hbl.cf

(for more information on HBL, see /usr/local/share/doc/spamassassin-dqs/README.md)

then restart spamassassin.
=====
Message from amavisd-milter-1.7.0_1:

--
To configure amavisd-milter, sendmail and amavisd-new point
your browser to http://github.com/prehor/amavisd-milter

Enable amavisd-milter in /etc/rc.conf with the following line:

	amavisd_milter_enable="YES"
=====
Message from spamass-milter-0.4.0_5:

--
spamass-milter has been installed, but it must be activated manually.
Please refer to...

  /usr/local/share/doc/spamass-milter/activation.txt

...for details.

You may also want to tweak your spamd rc.subr(8) startup flags to
specify a username to switch credentials to when delivering mail, if
applicable.
=====
Message from clamav-unofficial-sigs-7.2.5_3:

--
In order to start using clamav-unofficial-sigs, you need to configure
it first. Sample configuration files have been installed to:

/usr/local/etc/clamav-unofficial-sigs

All user configuration changes should go in file "user.conf". Modify
it according to your needs and when you are done set the value of
"user_configuration_complete" parameter to "yes".

NOTE: Starting with version 5.0.0 configuration has been split into
multiple files, which now reside in:

/usr/local/etc/clamav-unofficial-sigs

If you had previous version installed, you can remove the old
obsolete configuration file:

/usr/local/etc/clamav-unofficial-sigs.conf

To run the script periodically by cron, you also need to add it to
your crontab.
=====
Message from opendkim-2.10.3_20:

--
In order to run this port, write your opendkim.conf and:

if you use sendmail, add the milter socket `socketspec' in
/etc/mail/<your_configuration>.mc:

INPUT_MAIL_FILTER(`dkim-filter', `S=_YOUR_SOCKET_SPEC_, F=T, T=R:2m')

or if you use postfix write your milter socket `socketspec' in
/usr/local/etc/postfix/main.cf:

smtpd_milters = _YOUR_SOCKET_SPEC_


And to run the milter from startup, add milteropendkim_enable="YES" in
your /etc/rc.conf.
Extra options can be found in startup script.

Note: milter sockets must be accessible from postfix/smtpd;
  using inet sockets might be preferred.
=====
Message from spamd-4.9.1_7:

--
To enable spamd you need:

1) add required spamd entries to /etc/services, run command
     /usr/local/sbin/add-spamd-to-etc-service

2) Enable spamd in /etc/rc.conf with the following line:
   obspamd_enable="YES"
   obspamlogd_enable="YES"

   For PF you can specify a dedicated pflog interface with parameter
   obspamlogd_pflog_if. This interface will be created and removed
   by the rc script of spamlogd.

3) Configuration template is available in /usr/local/etc/spamd as
   spamd.conf.sample file.  Copy then to spamd.conf file and
   edit to suit your needs.

4) mount fdescfs to /dev/fd with the following line in /etc/fstab
	fdescfs  	/dev/fd  	fdescfs rw 	0 	0

   Note for XEN users:
   The XEN kernel ships without modules, therefore you have to add
   the following lines to the kernel config and build a new kernel.
	options FDESCFS
	device	pf
	device	pflog

5) Add following lines to the pf.conf(5)

  table <spamd-white> persist
  no rdr inet proto tcp from <spamd-white> to any \
      port smtp
  rdr pass inet proto tcp from any to any \
      port smtp -> 127.0.0.1 port spamd

FreeBSD only features (not in OpenBSD):
  - sync for spamdb (parameter -Y)
    See /usr/local/share/doc/spamd/ for usage.
Updating FreeBSD repository catalogue...
FreeBSD repository is up to date.
All repositories are up to date.
The following 1 package(s) will be affected (of 0 checked):

New packages to be INSTALLED:
	sshguard: 2.4.3_2,1

Number of packages to be installed: 1

The process will require 4 MiB more space.
529 KiB to be downloaded.
[1/1] Fetching sshguard-2.4.3_2,1.pkg: .......... done
Checking integrity... done (0 conflicting)
[1/1] Installing sshguard-2.4.3_2,1...
[1/1] Extracting sshguard-2.4.3_2,1: .......... done
=====
Message from sshguard-2.4.3_2,1:

--
To enable SSHGuard at startup, add the following line to your 'rc.conf':
sshguard_enable="YES"

Starting SSHGuard through syslogd(8) is discouraged and not supported.

Configure SSHGuard by editing BACKEND in '/usr/local/etc/sshguard.conf'. See
sshguard-setup(7) for instructions on setting up your firewall.

Please note that a few rc script parameters have been renamed to
better reflect the documentation:

sshguard_safety_thresh -> sshguard_danger_thresh
sshguard_pardon_min_interval -> sshguard_release_interval
sshguard_prescribe_interval -> sshguard_reset_interval
% cp /usr/share/zoneinfo/Europe/Vienna /etc/localtime
% echo "search eurobsdcon.lab" >> /etc/resolv.conf
% pw groupadd sshusers
% pw groupmod sshusers -m lab
% sed -i '' 's@#Port 22@Port 22\
AllowGroups sshusers\
Ciphers "chacha20-poly1305\@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm\@openssh.com,aes256-gcm\@openssh.com"@g' /etc/ssh/sshd_config
% sed -i  s@#LoginGraceTime 2m@LoginGraceTime 2m@g /etc/ssh/sshd_config
% sed -i  s@#PermitRootLogin no@PermitRootLogin no@g /etc/ssh/sshd_config
% sed -i  s@#StrictModes yes@StrictModes yes@g /etc/ssh/sshd_config
% sed -i  s@#MaxAuthTries 6@MaxAuthTries 3@g /etc/ssh/sshd_config
% sed -i  s@#MaxSessions 10@MaxSessions 3@g /etc/ssh/sshd_config
% sed -i  s@#PasswordAuthentication no@PasswordAuthentication no@g /etc/ssh/sshd_config
% sed -i  s@#AllowAgentForwarding yes@AllowAgentForwarding no@g /etc/ssh/sshd_config
% sed -i  s@#AllowTcpForwarding yes@AllowTcpForwarding no@g /etc/ssh/sshd_config
% sed -i  s@#Banner none@Banner none@g /etc/ssh/sshd_config
% pw user add lclchristianm -m
% service sendmail stop
Cannot 'stop' sendmail. Set sendmail_enable to YES in /etc/rc.conf or use 'onestop' instead of 'stop'.
Cannot 'stop' sendmail_msp_queue. Set sendmail_msp_queue_enable to YES in /etc/rc.conf or use 'onestop' instead of 'stop'.
% sysrc sendmail_enable=NONE
sendmail_enable: NONE -> NONE
% cat /etc/periodic.conf
daily_clean_hoststat_enable="NO"
daily_status_mail_rejects_enable="NO"
daily_status_include_submit_mailq="NO"
daily_submit_queuerun="NO"
% mkdir -p /usr/local/etc/mail
% install -m 0644 /usr/local/share/postfix/mailer.conf.postfix /usr/local/etc/mail/mailer.conf
% service redis enable
redis enabled in /etc/rc.conf
% service redis start
Starting redis.
% sysrc postfix_enable=YES
postfix_enable:  -> YES
% touch /usr/local/etc/postfix/vmailbox
% touch /usr/local/etc/postfix/virtualmap
% sed -i  /christian.moerz@eurobsdcon.lab/d /usr/local/etc/postfix/virtualmap
% sed -i  /virusalert@eurobsdcon.lab/d /usr/local/etc/postfix/virtualmap
% cat /usr/local/etc/postfix/virtualmap
christian.moerz@eurobsdcon.lab lclchristianm
poastmaster@eurobsdcon.lab lclchristianm
virusalert@eurobsdcon.lab virusalert
% postmap /usr/local/etc/postfix/virtualmap
% postmap /usr/local/etc/postfix/vmailbox
% sed -i  /^smtpd_tls_CAfile/d /usr/local/etc/postfix/main.cf
% sed -i  /^smtpd_tls_cert_file/d /usr/local/etc/postfix/main.cf
% sed -i  /^smtpd_tls_key_file/d /usr/local/etc/postfix/main.cf
% sed -i  /^smtpd_tls_security_level/d /usr/local/etc/postfix/main.cf
% sed -i  /^virtual_mailbox_domains/d /usr/local/etc/postfix/main.cf
% sed -i  /^virtual_mailbox_maps/d /usr/local/etc/postfix/main.cf
% sed -i  /^virtual_alias_maps/d /usr/local/etc/postfix/main.cf
% cat /usr/local/etc/postfix/main.cf
# Global Postfix configuration file. This file lists only a subset
# of all parameters. For the syntax, and for a complete parameter
# list, see the postconf(5) manual page (command: "man 5 postconf").
#
# TIP: use the command "postconf -n" to view main.cf parameter
# settings, "postconf parametername" to view a specific parameter,
# and "postconf 'parametername=value'" to set a specific parameter.
#
# For common configuration examples, see BASIC_CONFIGURATION_README
# and STANDARD_CONFIGURATION_README. To find these documents, use
# the command "postconf html_directory readme_directory", or go to
# http://www.postfix.org/BASIC_CONFIGURATION_README.html etc.
#
# For best results, change no more than 2-3 parameters at a time,
# and test if Postfix still works after every change.

# COMPATIBILITY
#
# The compatibility_level determines what default settings Postfix
# will use for main.cf and master.cf settings. These defaults will
# change over time.
#
# To avoid breaking things, Postfix will use backwards-compatible
# default settings and log where it uses those old backwards-compatible
# default settings, until the system administrator has determined
# if any backwards-compatible default settings need to be made
# permanent in main.cf or master.cf.
#
# When this review is complete, update the compatibility_level setting
# below as recommended in the RELEASE_NOTES file.
#
# The level below is what should be used with new (not upgrade) installs.
#
compatibility_level = 3.9

# SOFT BOUNCE
#
# The soft_bounce parameter provides a limited safety net for
# testing.  When soft_bounce is enabled, mail will remain queued that
# would otherwise bounce. This parameter disables locally-generated
# bounces, and prevents the SMTP server from rejecting mail permanently
# (by changing 5xx replies into 4xx replies). However, soft_bounce
# is no cure for address rewriting mistakes or mail routing mistakes.
#
#soft_bounce = no

# LOCAL PATHNAME INFORMATION
#
# The queue_directory specifies the location of the Postfix queue.
# This is also the root directory of Postfix daemons that run chrooted.
# See the files in examples/chroot-setup for setting up Postfix chroot
# environments on different UNIX systems.
#
queue_directory = /var/spool/postfix

# The command_directory parameter specifies the location of all
# postXXX commands.
#
command_directory = /usr/local/sbin

# The daemon_directory parameter specifies the location of all Postfix
# daemon programs (i.e. programs listed in the master.cf file). This
# directory must be owned by root.
#
daemon_directory = /usr/local/libexec/postfix

# The data_directory parameter specifies the location of Postfix-writable
# data files (caches, random numbers). This directory must be owned
# by the mail_owner account (see below).
#
data_directory = /var/db/postfix

# QUEUE AND PROCESS OWNERSHIP
#
# The mail_owner parameter specifies the owner of the Postfix queue
# and of most Postfix daemon processes.  Specify the name of a user
# account THAT DOES NOT SHARE ITS USER OR GROUP ID WITH OTHER ACCOUNTS
# AND THAT OWNS NO OTHER FILES OR PROCESSES ON THE SYSTEM.  In
# particular, don't specify nobody or daemon. PLEASE USE A DEDICATED
# USER.
#
mail_owner = postfix

# The default_privs parameter specifies the default rights used by
# the local delivery agent for delivery to external file or command.
# These rights are used in the absence of a recipient user context.
# DO NOT SPECIFY A PRIVILEGED USER OR THE POSTFIX OWNER.
#
#default_privs = nobody

# INTERNET HOST AND DOMAIN NAMES
# 
# The myhostname parameter specifies the internet hostname of this
# mail system. The default is to use the fully-qualified domain name
# from gethostname(). $myhostname is used as a default value for many
# other configuration parameters.
#
#myhostname = host.domain.tld
#myhostname = virtual.domain.tld

# The mydomain parameter specifies the local internet domain name.
# The default is to use $myhostname minus the first component.
# $mydomain is used as a default value for many other configuration
# parameters.
#
#mydomain = domain.tld

# SENDING MAIL
# 
# The myorigin parameter specifies the domain that locally-posted
# mail appears to come from. The default is to append $myhostname,
# which is fine for small sites.  If you run a domain with multiple
# machines, you should (1) change this to $mydomain and (2) set up
# a domain-wide alias database that aliases each user to
# user@that.users.mailhost.
#
# For the sake of consistency between sender and recipient addresses,
# myorigin also specifies the default domain name that is appended
# to recipient addresses that have no @domain part.
#
#myorigin = $myhostname
#myorigin = $mydomain

# RECEIVING MAIL

# The inet_interfaces parameter specifies the network interface
# addresses that this mail system receives mail on.  By default,
# the software claims all active interfaces on the machine. The
# parameter also controls delivery of mail to user@[ip.address].
#
# See also the proxy_interfaces parameter, for network addresses that
# are forwarded to us via a proxy or network address translator.
#
# Note: you need to stop/start Postfix when this parameter changes.
#
#inet_interfaces = all
#inet_interfaces = $myhostname
#inet_interfaces = $myhostname, localhost

# The proxy_interfaces parameter specifies the network interface
# addresses that this mail system receives mail on by way of a
# proxy or network address translation unit. This setting extends
# the address list specified with the inet_interfaces parameter.
#
# You must specify your proxy/NAT addresses when your system is a
# backup MX host for other domains, otherwise mail delivery loops
# will happen when the primary MX host is down.
#
#proxy_interfaces =
#proxy_interfaces = 1.2.3.4

# The mydestination parameter specifies the list of domains that this
# machine considers itself the final destination for.
#
# These domains are routed to the delivery agent specified with the
# local_transport parameter setting. By default, that is the UNIX
# compatible delivery agent that lookups all recipients in /etc/passwd
# and /etc/aliases or their equivalent.
#
# The default is $myhostname + localhost.$mydomain + localhost.  On
# a mail domain gateway, you should also include $mydomain.
#
# Do not specify the names of virtual domains - those domains are
# specified elsewhere (see VIRTUAL_README).
#
# Do not specify the names of domains that this machine is backup MX
# host for. Specify those names via the relay_domains settings for
# the SMTP server, or use permit_mx_backup if you are lazy (see
# STANDARD_CONFIGURATION_README).
#
# The local machine is always the final destination for mail addressed
# to user@[the.net.work.address] of an interface that the mail system
# receives mail on (see the inet_interfaces parameter).
#
# Specify a list of host or domain names, /file/name or type:table
# patterns, separated by commas and/or whitespace. A /file/name
# pattern is replaced by its contents; a type:table is matched when
# a name matches a lookup key (the right-hand side is ignored).
# Continue long lines by starting the next line with whitespace.
#
# See also below, section "REJECTING MAIL FOR UNKNOWN LOCAL USERS".
#
#mydestination = $myhostname, localhost.$mydomain, localhost
#mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
#mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain,
#	mail.$mydomain, www.$mydomain, ftp.$mydomain

# REJECTING MAIL FOR UNKNOWN LOCAL USERS
#
# The local_recipient_maps parameter specifies optional lookup tables
# with all names or addresses of users that are local with respect
# to $mydestination, $inet_interfaces or $proxy_interfaces.
#
# If this parameter is defined, then the SMTP server will reject
# mail for unknown local users. This parameter is defined by default.
#
# To turn off local recipient checking in the SMTP server, specify
# local_recipient_maps = (i.e. empty).
#
# The default setting assumes that you use the default Postfix local
# delivery agent for local delivery. You need to update the
# local_recipient_maps setting if:
#
# - You define $mydestination domain recipients in files other than
#   /etc/passwd, /etc/aliases, or the $virtual_alias_maps files.
#   For example, you define $mydestination domain recipients in    
#   the $virtual_mailbox_maps files.
#
# - You redefine the local delivery agent in master.cf.
#
# - You redefine the "local_transport" setting in main.cf.
#
# - You use the "luser_relay", "mailbox_transport", or "fallback_transport"
#   feature of the Postfix local delivery agent (see local(8)).
#
# Details are described in the LOCAL_RECIPIENT_README file.
#
# Beware: if the Postfix SMTP server runs chrooted, you probably have
# to access the passwd file via the proxymap service, in order to
# overcome chroot restrictions. The alternative, having a copy of
# the system passwd file in the chroot jail is just not practical.
#
# The right-hand side of the lookup tables is conveniently ignored.
# In the left-hand side, specify a bare username, an @domain.tld
# wild-card, or specify a user@domain.tld address.
# 
#local_recipient_maps = unix:passwd.byname $alias_maps
#local_recipient_maps = proxy:unix:passwd.byname $alias_maps
#local_recipient_maps =

# The unknown_local_recipient_reject_code specifies the SMTP server
# response code when a recipient domain matches $mydestination or
# ${proxy,inet}_interfaces, while $local_recipient_maps is non-empty
# and the recipient address or address local-part is not found.
#
# The default setting is 550 (reject mail) but it is safer to start
# with 450 (try again later) until you are certain that your
# local_recipient_maps settings are OK.
#
unknown_local_recipient_reject_code = 550

# TRUST AND RELAY CONTROL

# The mynetworks parameter specifies the list of "trusted" SMTP
# clients that have more privileges than "strangers".
#
# In particular, "trusted" SMTP clients are allowed to relay mail
# through Postfix.  See the smtpd_recipient_restrictions parameter
# in postconf(5).
#
# You can specify the list of "trusted" network addresses by hand
# or you can let Postfix do it for you (which is the default).
#
# By default (mynetworks_style = host), Postfix "trusts" only
# the local machine.
# 
# Specify "mynetworks_style = subnet" when Postfix should "trust"
# SMTP clients in the same IP subnetworks as the local machine.
# On Linux, this works correctly only with interfaces specified
# with the "ifconfig" or "ip" command.
#
# Specify "mynetworks_style = class" when Postfix should "trust" SMTP
# clients in the same IP class A/B/C networks as the local machine.
# Don't do this with a dialup site - it would cause Postfix to "trust"
# your entire provider's network.  Instead, specify an explicit
# mynetworks list by hand, as described below.
#  
# Specify "mynetworks_style = host" when Postfix should "trust"
# only the local machine.
# 
#mynetworks_style = class
#mynetworks_style = subnet
mynetworks_style = host

# Alternatively, you can specify the mynetworks list by hand, in
# which case Postfix ignores the mynetworks_style setting.
#
# Specify an explicit list of network/netmask patterns, where the
# mask specifies the number of bits in the network part of a host
# address.
#
# You can also specify the absolute pathname of a pattern file instead
# of listing the patterns here. Specify type:table for table-based lookups
# (the value on the table right-hand side is not used).
#
#mynetworks = 168.100.3.0/28, 127.0.0.0/8
#mynetworks = $config_directory/mynetworks
#mynetworks = hash:$config_directory/network_table

# The relay_domains parameter restricts what destinations this system will
# relay mail to.  See the smtpd_relay_restrictions and
# smtpd_recipient_restrictions descriptions in  postconf(5) for detailed
# information.
#
# By default, Postfix relays mail
# - from "trusted" clients (IP address matches $mynetworks, or is
#   SASL authenticated) to any destination,
# - from "untrusted" clients to destinations that match $relay_domains or
#   subdomains thereof, except addresses with sender-specified routing.
# The default relay_domains value is empty.
# 
# In addition to the above, the Postfix SMTP server by default accepts mail
# that Postfix is final destination for:
# - destinations that match $inet_interfaces or $proxy_interfaces,
# - destinations that match $mydestination
# - destinations that match $virtual_alias_domains,
# - destinations that match $virtual_mailbox_domains.
# These destinations do not need to be listed in $relay_domains.
# 
# Specify a list of hosts or domains, /file/name patterns or type:name
# lookup tables, separated by commas and/or whitespace.  Continue
# long lines by starting the next line with whitespace. A file name
# is replaced by its contents; a type:name table is matched when a
# (parent) domain appears as lookup key.
#
# NOTE: Postfix will not automatically forward mail for domains that
# list this system as their primary or backup MX host. See the
# permit_mx_backup restriction description in postconf(5).
#
#relay_domains = 

# INTERNET OR INTRANET

# The relayhost parameter specifies the default host to send mail to
# when no entry is matched in the optional transport(5) table. When
# no relayhost is given, mail is routed directly to the destination.
#
# On an intranet, specify the organizational domain name. If your
# internal DNS uses no MX records, specify the name of the intranet
# gateway host instead.
#
# In the case of SMTP, specify a domain, host, host:port, [host]:port,
# [address] or [address]:port; the form [host] turns off MX lookups.
#
# If you're connected via UUCP, see also the default_transport parameter.
#
#relayhost = $mydomain
#relayhost = [gateway.my.domain]
#relayhost = [mailserver.isp.tld]
#relayhost = uucphost
#relayhost = [an.ip.add.ress]

# REJECTING UNKNOWN RELAY USERS
#
# The relay_recipient_maps parameter specifies optional lookup tables
# with all addresses in the domains that match $relay_domains.
#
# If this parameter is defined, then the SMTP server will reject
# mail for unknown relay users. This feature is off by default.
#
# The right-hand side of the lookup tables is conveniently ignored.
# In the left-hand side, specify an @domain.tld wild-card, or specify
# a user@domain.tld address.
# 
#relay_recipient_maps = hash:$config_directory/relay_recipients

# INPUT RATE CONTROL
#
# The in_flow_delay configuration parameter implements mail input
# flow control. This feature is turned on by default, although it
# still needs further development (it's disabled on SCO UNIX due
# to an SCO bug).
# 
# A Postfix process will pause for $in_flow_delay seconds before
# accepting a new message, when the message arrival rate exceeds the
# message delivery rate. With the default 100 SMTP server process
# limit, this limits the mail inflow to 100 messages a second more
# than the number of messages delivered per second.
# 
# Specify 0 to disable the feature. Valid delays are 0..10.
# 
#in_flow_delay = 1s

# ADDRESS REWRITING
#
# The ADDRESS_REWRITING_README document gives information about
# address masquerading or other forms of address rewriting including
# username->Firstname.Lastname mapping.

# ADDRESS REDIRECTION (VIRTUAL DOMAIN)
#
# The VIRTUAL_README document gives information about the many forms
# of domain hosting that Postfix supports.

# "USER HAS MOVED" BOUNCE MESSAGES
#
# See the discussion in the ADDRESS_REWRITING_README document.

# TRANSPORT MAP
#
# See the discussion in the ADDRESS_REWRITING_README document.

# ALIAS DATABASE
#
# The alias_maps parameter specifies the list of alias databases used
# by the local delivery agent. The default list is system dependent.
#
# On systems with NIS, the default is to search the local alias
# database, then the NIS alias database. See aliases(5) for syntax
# details.
# 
# If you change the alias database, run "postalias /etc/aliases" (or
# wherever your system stores the mail alias file), or simply run
# "newaliases" to build the necessary DBM or DB file.
#
# It will take a minute or so before changes become visible.  Use
# "postfix reload" to eliminate the delay.
#
#alias_maps = dbm:/etc/aliases
#alias_maps = hash:/etc/aliases
#alias_maps = hash:/etc/aliases, nis:mail.aliases
#alias_maps = netinfo:/aliases

# The alias_database parameter specifies the alias database(s) that
# are built with "newaliases" or "sendmail -bi".  This is a separate
# configuration parameter, because alias_maps (see above) may specify
# tables that are not necessarily all under control by Postfix.
#
#alias_database = dbm:/etc/aliases
#alias_database = hash:/etc/aliases
#alias_database = hash:/etc/aliases, hash:/opt/majordomo/aliases

# ADDRESS EXTENSIONS (e.g., user+foo)
#
# The recipient_delimiter parameter specifies the separator between
# user names and address extensions (user+foo). See canonical(5),
# local(8), relocated(5) and virtual(5) for the effects this has on
# aliases, canonical, virtual, relocated and .forward file lookups.
# Basically, the software tries user+foo and .forward+foo before
# trying user and .forward.
#
#recipient_delimiter = +

# DELIVERY TO MAILBOX
#
# The home_mailbox parameter specifies the optional pathname of a
# mailbox file relative to a user's home directory. The default
# mailbox file is /var/spool/mail/user or /var/mail/user.  Specify
# "Maildir/" for qmail-style delivery (the / is required).
#
#home_mailbox = Mailbox
#home_mailbox = Maildir/
 
# The mail_spool_directory parameter specifies the directory where
# UNIX-style mailboxes are kept. The default setting depends on the
# system type.
#
#mail_spool_directory = /var/mail
#mail_spool_directory = /var/spool/mail

# The mailbox_command parameter specifies the optional external
# command to use instead of mailbox delivery. The command is run as
# the recipient with proper HOME, SHELL and LOGNAME environment settings.
# Exception:  delivery for root is done as $default_privs.
#
# Other environment variables of interest: USER (recipient username),
# EXTENSION (address extension), DOMAIN (domain part of address),
# and LOCAL (the address localpart).
#
# Unlike other Postfix configuration parameters, the mailbox_command
# parameter is not subjected to $parameter substitutions. This is to
# make it easier to specify shell syntax (see example below).
#
# Avoid shell meta characters because they will force Postfix to run
# an expensive shell process. Procmail alone is expensive enough.
#
# IF YOU USE THIS TO DELIVER MAIL SYSTEM-WIDE, YOU MUST SET UP AN
# ALIAS THAT FORWARDS MAIL FOR ROOT TO A REAL USER.
#
#mailbox_command = /some/where/procmail
#mailbox_command = /some/where/procmail -a "$EXTENSION"

# The mailbox_transport specifies the optional transport in master.cf
# to use after processing aliases and .forward files. This parameter
# has precedence over the mailbox_command, fallback_transport and
# luser_relay parameters.
#
# Specify a string of the form transport:nexthop, where transport is
# the name of a mail delivery transport defined in master.cf.  The
# :nexthop part is optional. For more details see the sample transport
# configuration file.
#
# NOTE: if you use this feature for accounts not in the UNIX password
# file, then you must update the "local_recipient_maps" setting in
# the main.cf file, otherwise the SMTP server will reject mail for    
# non-UNIX accounts with "User unknown in local recipient table".
#
# Cyrus IMAP over LMTP. Specify ``lmtpunix      cmd="lmtpd"
# listen="/var/imap/socket/lmtp" prefork=0'' in cyrus.conf.
#mailbox_transport = lmtp:unix:/var/imap/socket/lmtp
#
# Cyrus IMAP via command line. Uncomment the "cyrus...pipe" and
# subsequent line in master.cf.
#mailbox_transport = cyrus

# The fallback_transport specifies the optional transport in master.cf
# to use for recipients that are not found in the UNIX passwd database.
# This parameter has precedence over the luser_relay parameter.
#
# Specify a string of the form transport:nexthop, where transport is
# the name of a mail delivery transport defined in master.cf.  The
# :nexthop part is optional. For more details see the sample transport
# configuration file.
#
# NOTE: if you use this feature for accounts not in the UNIX password
# file, then you must update the "local_recipient_maps" setting in
# the main.cf file, otherwise the SMTP server will reject mail for    
# non-UNIX accounts with "User unknown in local recipient table".
#
#fallback_transport = lmtp:unix:/file/name
#fallback_transport = cyrus
#fallback_transport =

# The luser_relay parameter specifies an optional destination address
# for unknown recipients.  By default, mail for unknown@$mydestination,
# unknown@[$inet_interfaces] or unknown@[$proxy_interfaces] is returned
# as undeliverable.
#
# The following expansions are done on luser_relay: $user (recipient
# username), $shell (recipient shell), $home (recipient home directory),
# $recipient (full recipient address), $extension (recipient address
# extension), $domain (recipient domain), $local (entire recipient
# localpart), $recipient_delimiter. Specify ${name?value} or
# ${name:value} to expand value only when $name does (does not) exist.
#
# luser_relay works only for the default Postfix local delivery agent.
#
# NOTE: if you use this feature for accounts not in the UNIX password
# file, then you must specify "local_recipient_maps =" (i.e. empty) in
# the main.cf file, otherwise the SMTP server will reject mail for    
# non-UNIX accounts with "User unknown in local recipient table".
#
#luser_relay = $user@other.host
#luser_relay = $local@other.host
#luser_relay = admin+$local
  
# JUNK MAIL CONTROLS
# 
# The controls listed here are only a very small subset. The file
# SMTPD_ACCESS_README provides an overview.

# The header_checks parameter specifies an optional table with patterns
# that each logical message header is matched against, including
# headers that span multiple physical lines.
#
# By default, these patterns also apply to MIME headers and to the
# headers of attached messages. With older Postfix versions, MIME and
# attached message headers were treated as body text.
#
# For details, see "man header_checks".
#
#header_checks = regexp:$config_directory/header_checks

# FAST ETRN SERVICE
#
# Postfix maintains per-destination logfiles with information about
# deferred mail, so that mail can be flushed quickly with the SMTP
# "ETRN domain.tld" command, or by executing "sendmail -qRdomain.tld".
# See the ETRN_README document for a detailed description.
# 
# The fast_flush_domains parameter controls what destinations are
# eligible for this service. By default, they are all domains that
# this server is willing to relay mail to.
# 
#fast_flush_domains = $relay_domains

# SHOW SOFTWARE VERSION OR NOT
#
# The smtpd_banner parameter specifies the text that follows the 220
# code in the SMTP server's greeting banner. Some people like to see
# the mail version advertised. By default, Postfix shows no version.
#
# You MUST specify $myhostname at the start of the text. That is an
# RFC requirement. Postfix itself does not care.
#
#smtpd_banner = $myhostname ESMTP $mail_name
#smtpd_banner = $myhostname ESMTP $mail_name ($mail_version)

# PARALLEL DELIVERY TO THE SAME DESTINATION
#
# How many parallel deliveries to the same user or domain? With local
# delivery, it does not make sense to do massively parallel delivery
# to the same user, because mailbox updates must happen sequentially,
# and expensive pipelines in .forward files can cause disasters when
# too many are run at the same time. With SMTP deliveries, 10
# simultaneous connections to the same domain could be sufficient to
# raise eyebrows.
# 
# Each message delivery transport has its XXX_destination_concurrency_limit
# parameter.  The default is $default_destination_concurrency_limit for
# most delivery transports. For the local delivery agent the default is 2.

#local_destination_concurrency_limit = 2
#default_destination_concurrency_limit = 20

# DEBUGGING CONTROL
#
# The debug_peer_level parameter specifies the increment in verbose
# logging level when an SMTP client or server host name or address
# matches a pattern in the debug_peer_list parameter.
#
debug_peer_level = 2

# The debug_peer_list parameter specifies an optional list of domain
# or network patterns, /file/name patterns or type:name tables. When
# an SMTP client or server host name or address matches a pattern,
# increase the verbose logging level by the amount specified in the
# debug_peer_level parameter.
#
#debug_peer_list = 127.0.0.1
#debug_peer_list = some.domain

# The debugger_command specifies the external command that is executed
# when a Postfix daemon program is run with the -D option.
#
# Use "command .. & sleep 5" so that the debugger can attach before
# the process marches on. If you use an X-based debugger, be sure to
# set up your XAUTHORITY environment variable before starting Postfix.
#
debugger_command =
	 PATH=/bin:/usr/bin:/usr/local/bin:/usr/X11R6/bin
	 ddd $daemon_directory/$process_name $process_id & sleep 5

# If you can't use X, use this to capture the call stack when a
# daemon crashes. The result is in a file in the configuration
# directory, and is named after the process name and the process ID.
#
# debugger_command =
#	PATH=/bin:/usr/bin:/usr/local/bin; export PATH; (echo cont;
#	echo where) | gdb $daemon_directory/$process_name $process_id 2>&1
#	>$config_directory/$process_name.$process_id.log & sleep 5
#
# Another possibility is to run gdb under a detached screen session.
# To attach to the screen session, su root and run "screen -r
# <id_string>" where <id_string> uniquely matches one of the detached
# sessions (from "screen -list").
#
# debugger_command =
#	PATH=/bin:/usr/bin:/sbin:/usr/sbin; export PATH; screen
#	-dmS $process_name gdb $daemon_directory/$process_name
#	$process_id & sleep 1

# INSTALL-TIME CONFIGURATION INFORMATION
#
# The following parameters are used when installing a new Postfix version.
# 
# sendmail_path: The full pathname of the Postfix sendmail command.
# This is the Sendmail-compatible mail posting interface.
# 
sendmail_path = /usr/local/sbin/sendmail

# newaliases_path: The full pathname of the Postfix newaliases command.
# This is the Sendmail-compatible command to build alias databases.
#
newaliases_path = /usr/local/bin/newaliases

# mailq_path: The full pathname of the Postfix mailq command.  This
# is the Sendmail-compatible mail queue listing command.
# 
mailq_path = /usr/local/bin/mailq

# setgid_group: The group for mail submission and queue management
# commands.  This must be a group name with a numerical group ID that
# is not shared with other accounts, not even with the Postfix account.
#
setgid_group = maildrop

# html_directory: The location of the Postfix HTML documentation.
#
html_directory = /usr/local/share/doc/postfix

# manpage_directory: The location of the Postfix on-line manual pages.
#
manpage_directory = /usr/local/share/man

# sample_directory: The location of the Postfix sample configuration files.
# This parameter is obsolete as of Postfix 2.1.
#
sample_directory = /usr/local/etc/postfix

# readme_directory: The location of the Postfix README files.
#
readme_directory = /usr/local/share/doc/postfix
inet_protocols = all

# smtp CA path (default to system-wide location)
smtp_tls_CApath = /etc/ssl/certs
meta_directory = /usr/local/libexec/postfix
shlib_directory = /usr/local/lib/postfix
smtpd_tls_CAfile = /usr/local/etc/ssl/ca.crt
smtpd_tls_cert_file = /usr/local/etc/ssl/server.crt
smtpd_tls_key_file = /usr/local/etc/ssl/server.key
smtpd_tls_security_level = may
smtpd_tls_auth_only = yes

# virtual delivery configuration
virtual_mailbox_domains = eurobsdcon.lab
virtual_transport = lmtp:unix:/var/imap/socket/lmtp
virtual_mailbox_maps = hash:/usr/local/etc/postfix/vmailbox
virtual_alias_maps = hash:/usr/local/etc/postfix/virtualmap
% sed -i  s@#mailbox_transport = lmtp@mailbox_transport = lmtp@g /usr/local/etc/postfix/main.cf
% sed -i  s@#myhostname = host.domain.tld@myhostname = mail2.eurobsdcon.lab@g /usr/local/etc/postfix/main.cf
% sed -i  s@#mydomain = domain.tld@mydomain = eurobsdcon.lab@g /usr/local/etc/postfix/main.cf
% sed -i  s@#local_recipient_maps = unix:passwd.byname \$alias_maps$@local_recipient_maps = unix:passwd.byname $alias_maps@g /usr/local/etc/postfix/main.cf
% sed -i  s@#mynetworks = 168.100.3.0/28, 127.0.0.0/8@mynetworks = 10.193.167.0/24@g /usr/local/etc/postfix/main.cf
% sysrc saslauthd_enable=YES
saslauthd_enable:  -> YES
% mkdir -p /usr/local/etc/ssl
% install -m 0400 server.key /usr/local/etc/ssl/server.key
% install -m 0444 server.crt /usr/local/etc/ssl/server.crt
% install -m 0444 -o cyrus server.key /usr/local/etc/ssl/cyrus.key
% install -m 0444 ca.crt /usr/local/etc/ssl/ca.crt
% install -m 0444 ca.crt /etc/ssl/certs/ca.crt
% install -m 0444 ca.crt /usr/share/certs/trusted/NY_Central.pem
% cp /usr/local/etc/ssl/cert.pem /usr/local/etc/ssl/cert.pem.ca
% cat ca.crt >> /usr/local/etc/ssl/cert.pem
% cat ca.crt >> /etc/ssl/cert.pem
% certctl trust ca.crt
% openssl rehash /etc/ssl/certs
% certctl rehash
Scanning /usr/share/certs/untrusted for certificates...
Scanning /usr/share/certs/trusted for certificates...
Scanning /usr/local/share/certs for certificates...
% sed -i '' "s@#servername:@servername: mail2.eurobsdcon.lab\
#servername:@g" /usr/local/etc/postfix/main.cf
% sed -i  s@#tls_server_cert: <none>@tls_server_cert: /usr/local/etc/ssl/server.crt@g /usr/local/etc/imapd.conf
% sed -i '' "s@#tls_server_key: <none>@tls_server_key: /usr/local/etc/ssl/cyrus.key\
tls_server_dhparam: /usr/local/etc/ssl/dhparams.pem\
tls_versions: tls1_2 tls1_3\
debug: 1@g" /usr/local/etc/imapd.conf
% sed -i  s@#tls_client_ca_file: <none>@tls_client_ca_file: /usr/local/etc/ssl/ca.crt@g /usr/local/etc/imapd.conf
% sed -i  s@#admins: <none>@admins: cyrus@g /usr/local/etc/imapd.conf
% sed -i  s@#lmtpsocket:@lmtpsocket:@g /usr/local/etc/imapd.conf
% sed -i  s@  pop3@#  pop3@g /usr/local/etc/cyrus.conf
% install -m 0644 dhparams.pem /usr/local/etc/ssl/dhparams.pem
% mkdir -p /var/imap
% /usr/local/cyrus/sbin/mkimap
reading configure file /usr/local/etc/imapd.conf...
I will configure directory /var/imap.
I saw partition /var/spool/imap.
done
configuring /var/imap...
creating /var/spool/imap...
done
% chpass cyrus
  // alternatively, use following commands:
  // echo password | openssl passwd -6 -stdin
  // chpass -p hashedpass cyrus
% sysrc cyrus_imapd_enable=YES
cyrus_imapd_enable:  -> YES
% service saslauthd start
Starting saslauthd.
% saslpasswd2 -p -c cyrus
% saslpasswd2 -p -c lclchristianm
% service imapd start
Starting cyrus_imapd.
% service postfix start
% ... cyradm : cm lclchristianm, cm virusalert ...
CONNECTED(00000003)
---
Certificate chain
 0 s:CN = mail.eurobsdcon.lab
   i:CN = Easy-RSA CA
   a:PKEY: rsaEncryption, 2048 (bit); sigalg: RSA-SHA256
   v:NotBefore: Sep  8 13:46:41 2024 GMT; NotAfter: Dec 12 13:46:41 2026 GMT
 1 s:CN = Easy-RSA CA
   i:CN = Easy-RSA CA
   a:PKEY: rsaEncryption, 2048 (bit); sigalg: RSA-SHA256
   v:NotBefore: Sep  8 13:46:33 2024 GMT; NotAfter: Sep  6 13:46:33 2034 GMT
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIDgTCCAmmgAwIBAgIQHa5uYpwdKQs/GinyNfliVjANBgkqhkiG9w0BAQsFADAW
MRQwEgYDVQQDDAtFYXN5LVJTQSBDQTAeFw0yNDA5MDgxMzQ2NDFaFw0yNjEyMTIx
MzQ2NDFaMB4xHDAaBgNVBAMME21haWwuZXVyb2JzZGNvbi5sYWIwggEiMA0GCSqG
SIb3DQEBAQUAA4IBDwAwggEKAoIBAQCuOF3hClDDHbdKDp+Yp6tWDu/CY6emkdDc
4yTOc1ZEVUYvZbntOMuqsreskb0GyDFt5hbrge4nma6IqCSIKmN5NuQKRS0ueYf1
dEAn0LV2Ra3PgrAGV5oXXsg7QToCru2l6IxG5lQc7QFA1eO9UrstR2mAgQGuBmzX
YG2XtZnu3qtmKpjWVZ9YEkS98QAeqexBjezgbdsXeMLp5CL0UmUzY3fFc9/Q2zKi
fVFH5q4RlXf9mYiTliYtE15BErjQ8koRlLnzd9aRpNSeGfA8hf/4KylMZP+N2GPJ
YYfXbjyU/4UX4QMANyy0mfg1xpw0NInUQX8zVEdAyWiDW3O50QelAgMBAAGjgcIw
gb8wCQYDVR0TBAIwADAdBgNVHQ4EFgQUVb5vMZ+icF0p1/5UMe7LJpcoszEwUQYD
VR0jBEowSIAUDoNqduiZ4zr0RBXsf3gVwYBu5fOhGqQYMBYxFDASBgNVBAMMC0Vh
c3ktUlNBIENBghR7Ah73VOVgXxTRZaFavunUMJ9UJDATBgNVHSUEDDAKBggrBgEF
BQcDATALBgNVHQ8EBAMCBaAwHgYDVR0RBBcwFYITbWFpbC5ldXJvYnNkY29uLmxh
YjANBgkqhkiG9w0BAQsFAAOCAQEAC+CSi4skE2UZ/CA3Y4hdSOTfu60Ag2YZWVud
lUEyf6IaeKzToaDbubkNAg8X3kOfj6JSELyV6yGY03tytDncHS6XgPcNMdT4RpQN
4WWG3ACxfvMnStWqQdaUSGB5e0WuMGKNe/9wORy5zEFqKDRRvgOsz5f/ieUfeb/j
2vJtNflfqPnKDdVB3I+TiTKItqLHOqy4YeRAjpUm0HZUPkEyOVTue0B7umpZ8G6m
jA5DXoJBqlMCZwQLgLAO1QhF3WyIgrqWhT9gF49nk7T9K4QeMqnwcW16pDr4ZRVB
FL9eEoRNYBONJtLMCNyBF/LEG07uGHPD6FQmE8Knnx0Hdx5wmw==
-----END CERTIFICATE-----
subject=CN = mail.eurobsdcon.lab
issuer=CN = Easy-RSA CA
---
Acceptable client certificate CA names
CN = Easy-RSA CA
Requested Signature Algorithms: ECDSA+SHA256:ECDSA+SHA384:ECDSA+SHA512:Ed25519:Ed448:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA+SHA256:RSA+SHA384:RSA+SHA512:ECDSA+SHA224:RSA+SHA224
Shared Requested Signature Algorithms: ECDSA+SHA256:ECDSA+SHA384:ECDSA+SHA512:Ed25519:Ed448:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA+SHA256:RSA+SHA384:RSA+SHA512
Peer signing digest: SHA256
Peer signature type: RSA-PSS
Server Temp Key: ECDH, prime256v1, 256 bits
---
SSL handshake has read 2534 bytes and written 737 bytes
Verification: OK
---
New, TLSv1.3, Cipher is TLS_AES_256_GCM_SHA384
Server public key is 2048 bit
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
No ALPN negotiated
Early data was not sent
Verify return code: 0 (ok)
---
CONNECTED(00000003)
---
Certificate chain
 0 s:CN = mail.eurobsdcon.lab
   i:CN = Easy-RSA CA
   a:PKEY: rsaEncryption, 2048 (bit); sigalg: RSA-SHA256
   v:NotBefore: Sep  8 13:46:41 2024 GMT; NotAfter: Dec 12 13:46:41 2026 GMT
 1 s:CN = Easy-RSA CA
   i:CN = Easy-RSA CA
   a:PKEY: rsaEncryption, 2048 (bit); sigalg: RSA-SHA256
   v:NotBefore: Sep  8 13:46:33 2024 GMT; NotAfter: Sep  6 13:46:33 2034 GMT
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIDgTCCAmmgAwIBAgIQHa5uYpwdKQs/GinyNfliVjANBgkqhkiG9w0BAQsFADAW
MRQwEgYDVQQDDAtFYXN5LVJTQSBDQTAeFw0yNDA5MDgxMzQ2NDFaFw0yNjEyMTIx
MzQ2NDFaMB4xHDAaBgNVBAMME21haWwuZXVyb2JzZGNvbi5sYWIwggEiMA0GCSqG
SIb3DQEBAQUAA4IBDwAwggEKAoIBAQCuOF3hClDDHbdKDp+Yp6tWDu/CY6emkdDc
4yTOc1ZEVUYvZbntOMuqsreskb0GyDFt5hbrge4nma6IqCSIKmN5NuQKRS0ueYf1
dEAn0LV2Ra3PgrAGV5oXXsg7QToCru2l6IxG5lQc7QFA1eO9UrstR2mAgQGuBmzX
YG2XtZnu3qtmKpjWVZ9YEkS98QAeqexBjezgbdsXeMLp5CL0UmUzY3fFc9/Q2zKi
fVFH5q4RlXf9mYiTliYtE15BErjQ8koRlLnzd9aRpNSeGfA8hf/4KylMZP+N2GPJ
YYfXbjyU/4UX4QMANyy0mfg1xpw0NInUQX8zVEdAyWiDW3O50QelAgMBAAGjgcIw
gb8wCQYDVR0TBAIwADAdBgNVHQ4EFgQUVb5vMZ+icF0p1/5UMe7LJpcoszEwUQYD
VR0jBEowSIAUDoNqduiZ4zr0RBXsf3gVwYBu5fOhGqQYMBYxFDASBgNVBAMMC0Vh
c3ktUlNBIENBghR7Ah73VOVgXxTRZaFavunUMJ9UJDATBgNVHSUEDDAKBggrBgEF
BQcDATALBgNVHQ8EBAMCBaAwHgYDVR0RBBcwFYITbWFpbC5ldXJvYnNkY29uLmxh
YjANBgkqhkiG9w0BAQsFAAOCAQEAC+CSi4skE2UZ/CA3Y4hdSOTfu60Ag2YZWVud
lUEyf6IaeKzToaDbubkNAg8X3kOfj6JSELyV6yGY03tytDncHS6XgPcNMdT4RpQN
4WWG3ACxfvMnStWqQdaUSGB5e0WuMGKNe/9wORy5zEFqKDRRvgOsz5f/ieUfeb/j
2vJtNflfqPnKDdVB3I+TiTKItqLHOqy4YeRAjpUm0HZUPkEyOVTue0B7umpZ8G6m
jA5DXoJBqlMCZwQLgLAO1QhF3WyIgrqWhT9gF49nk7T9K4QeMqnwcW16pDr4ZRVB
FL9eEoRNYBONJtLMCNyBF/LEG07uGHPD6FQmE8Knnx0Hdx5wmw==
-----END CERTIFICATE-----
subject=CN = mail.eurobsdcon.lab
issuer=CN = Easy-RSA CA
---
Acceptable client certificate CA names
CN = Easy-RSA CA
Requested Signature Algorithms: ECDSA+SHA256:ECDSA+SHA384:ECDSA+SHA512:Ed25519:Ed448:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA+SHA256:RSA+SHA384:RSA+SHA512:ECDSA+SHA224:RSA+SHA224
Shared Requested Signature Algorithms: ECDSA+SHA256:ECDSA+SHA384:ECDSA+SHA512:Ed25519:Ed448:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA+SHA256:RSA+SHA384:RSA+SHA512
Peer signing digest: SHA256
Peer signature type: RSA-PSS
Server Temp Key: ECDH, prime256v1, 256 bits
---
SSL handshake has read 2534 bytes and written 737 bytes
Verification: OK
---
New, TLSv1.3, Cipher is TLS_AES_256_GCM_SHA384
Server public key is 2048 bit
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
No ALPN negotiated
Early data was not sent
Verify return code: 0 (ok)
---
% newaliases
% service postfix restart
% sysrc spamd_enable=YES
spamd_enable:  -> YES
% sysrc spamd_flags=-u spamd -H /var/spool/spamd
spamd_flags:  -> -u spamd -H /var/spool/spamd
% sa-update
% sa-compile
% service sa-spamd start
Starting spamd.
% sed -i '' "s@# bayes_auto_learn 1@bayes_auto_learn 0\
bayes_path /var/maiad/.spamassassin/bayes\
bayes_file_mode 0775\
@g" /usr/local/etc/mail/spamassassin/local.cf
% sed -i '' "s@# rewrite_header Subject \*\*\*\*\*SPAM\*\*\*\*\*@rewrite_header Subject [SPAM]\
add_header all Report _REPORT_\
report_safe 1@g" /usr/local/etc/mail/spamassassin/local.cf
% service spamass-milter enable
spamass_milter enabled in /etc/rc.conf
% sysrc spamass_milter_socket_owner=spamd
spamass_milter_socket_owner:  -> spamd
% sysrc spamass_milter_socket_group=postfix
spamass_milter_socket_group:  -> postfix
% sysrc spamass_milter_socket_mode=664
spamass_milter_socket_mode:  -> 664
% service spamass-milter start
Starting spamass_milter.
% mkdir -p /var/maiad/.spamassassin/bayes
% chown -R spamd /var/maiad
% sysrc clamav_freshclam_enable=YES
clamav_freshclam_enable:  -> YES
% sysrc clamav_clamd_enable=YES
clamav_clamd_enable:  -> YES
% service clamav-freshclam start
Starting clamav_freshclam.
% freshclam
ClamAV update process started at Sat Sep 14 11:50:52 2024
daily database available for update (local version: 27392, remote version: 27398)
Testing database: '/var/db/clamav/tmp.b64aa6572d/clamav-340bdfb5765cf9f111789406b2311698.tmp-daily.cld' ...
Database test passed.
daily.cld updated (version: 27398, sigs: 2066825, f-level: 90, builder: raynman)
main.cvd database is up-to-date (version: 62, sigs: 6647427, f-level: 90, builder: sigmgr)
bytecode.cvd database is up-to-date (version: 335, sigs: 86, f-level: 90, builder: raynman)
% service clamav-clamd start
Starting clamav_clamd.
% sysrc amavisd_enable=YES
amavisd_enable:  -> YES
% cat %{MASTERCF}
#
# Postfix master process configuration file.  For details on the format
# of the file, see the master(5) manual page (command: "man 5 master" or
# on-line: http://www.postfix.org/master.5.html).
#
# Do not forget to execute "postfix reload" after editing this file.
#
# ==========================================================================
# service type  private unpriv  chroot  wakeup  maxproc command + args
#               (yes)   (yes)   (no)    (never) (100)
# ==========================================================================
smtp      inet  n       -       n       -       -       smtpd
#smtp      inet  n       -       n       -       1       postscreen
#smtpd     pass  -       -       n       -       -       smtpd
#dnsblog   unix  -       -       n       -       0       dnsblog
#tlsproxy  unix  -       -       n       -       0       tlsproxy
# Choose one: enable submission for loopback clients only, or for any client.
#127.0.0.1:submission inet n -   n       -       -       smtpd
#submission inet n       -       n       -       -       smtpd
#  -o syslog_name=postfix/submission
#  -o smtpd_tls_security_level=encrypt
#  -o smtpd_sasl_auth_enable=yes
#  -o smtpd_tls_auth_only=yes
#  -o local_header_rewrite_clients=static:all
#  -o smtpd_reject_unlisted_recipient=no
#     Instead of specifying complex smtpd_<xxx>_restrictions here,
#     specify "smtpd_<xxx>_restrictions=$mua_<xxx>_restrictions"
#     here, and specify mua_<xxx>_restrictions in main.cf (where
#     "<xxx>" is "client", "helo", "sender", "relay", or "recipient").
#  -o smtpd_client_restrictions=
#  -o smtpd_helo_restrictions=
#  -o smtpd_sender_restrictions=
#  -o smtpd_relay_restrictions=
#  -o smtpd_recipient_restrictions=permit_sasl_authenticated,reject
#  -o milter_macro_daemon_name=ORIGINATING
# Choose one: enable submissions for loopback clients only, or for any client.
#127.0.0.1:submissions inet n  -       n       -       -       smtpd
#submissions     inet  n       -       n       -       -       smtpd
#  -o syslog_name=postfix/submissions
#  -o smtpd_tls_wrappermode=yes
#  -o smtpd_sasl_auth_enable=yes
#  -o local_header_rewrite_clients=static:all
#  -o smtpd_reject_unlisted_recipient=no
#     Instead of specifying complex smtpd_<xxx>_restrictions here,
#     specify "smtpd_<xxx>_restrictions=$mua_<xxx>_restrictions"
#     here, and specify mua_<xxx>_restrictions in main.cf (where
#     "<xxx>" is "client", "helo", "sender", "relay", or "recipient").
#  -o smtpd_client_restrictions=
#  -o smtpd_helo_restrictions=
#  -o smtpd_sender_restrictions=
#  -o smtpd_relay_restrictions=
#  -o smtpd_recipient_restrictions=permit_sasl_authenticated,reject
#  -o milter_macro_daemon_name=ORIGINATING
#628       inet  n       -       n       -       -       qmqpd
pickup    unix  n       -       n       60      1       pickup
cleanup   unix  n       -       n       -       0       cleanup
qmgr      unix  n       -       n       300     1       qmgr
#qmgr     unix  n       -       n       300     1       oqmgr
tlsmgr    unix  -       -       n       1000?   1       tlsmgr
rewrite   unix  -       -       n       -       -       trivial-rewrite
bounce    unix  -       -       n       -       0       bounce
defer     unix  -       -       n       -       0       bounce
trace     unix  -       -       n       -       0       bounce
verify    unix  -       -       n       -       1       verify
flush     unix  n       -       n       1000?   0       flush
proxymap  unix  -       -       n       -       -       proxymap
proxywrite unix -       -       n       -       1       proxymap
smtp      unix  -       -       n       -       -       smtp
relay     unix  -       -       n       -       -       smtp
        -o syslog_name=postfix/$service_name
#       -o smtp_helo_timeout=5 -o smtp_connect_timeout=5
showq     unix  n       -       n       -       -       showq
error     unix  -       -       n       -       -       error
retry     unix  -       -       n       -       -       error
discard   unix  -       -       n       -       -       discard
local     unix  -       n       n       -       -       local
virtual   unix  -       n       n       -       -       virtual
lmtp      unix  -       -       n       -       -       lmtp
anvil     unix  -       -       n       -       1       anvil
scache    unix  -       -       n       -       1       scache
postlog   unix-dgram n  -       n       -       1       postlogd
#
# ====================================================================
# Interfaces to non-Postfix software. Be sure to examine the manual
# pages of the non-Postfix software to find out what options it wants.
#
# Many of the following services use the Postfix pipe(8) delivery
# agent.  See the pipe(8) man page for information about ${recipient}
# and other message envelope options.
# ====================================================================
#
# maildrop. See the Postfix MAILDROP_README file for details.
# Also specify in main.cf: maildrop_destination_recipient_limit=1
#
#maildrop  unix  -       n       n       -       -       pipe
#  flags=DRXhu user=vmail argv=/usr/local/bin/maildrop -d ${recipient}
#
# ====================================================================
#
# Recent Cyrus versions can use the existing "lmtp" master.cf entry.
#
# Specify in cyrus.conf:
#   lmtp    cmd="lmtpd -a" listen="localhost:lmtp" proto=tcp4
#
# Specify in main.cf one or more of the following:
#  mailbox_transport = lmtp:inet:localhost
#  virtual_transport = lmtp:inet:localhost
#
# ====================================================================
#
# Cyrus 2.1.5 (Amos Gouaux)
# Also specify in main.cf: cyrus_destination_recipient_limit=1
#
#cyrus     unix  -       n       n       -       -       pipe
#  flags=DRX user=cyrus argv=/cyrus/bin/deliver -e -r ${sender} -m ${extension} ${user}
#
# ====================================================================
#
# Old example of delivery via Cyrus.
#
#old-cyrus unix  -       n       n       -       -       pipe
#  flags=R user=cyrus argv=/cyrus/bin/deliver -e -m ${extension} ${user}
#
# ====================================================================
#
# See the Postfix UUCP_README file for configuration details.
#
#uucp      unix  -       n       n       -       -       pipe
#  flags=Fqhu user=uucp argv=uux -r -n -z -a$sender - $nexthop!rmail ($recipient)
#
# ====================================================================
#
# Other external delivery methods.
#
#ifmail    unix  -       n       n       -       -       pipe
#  flags=F user=ftn argv=/usr/lib/ifmail/ifmail -r $nexthop ($recipient)
#
#bsmtp     unix  -       n       n       -       -       pipe
#  flags=Fq. user=bsmtp argv=/usr/local/sbin/bsmtp -f $sender $nexthop $recipient
#
#scalemail-backend unix -       n       n       -       2       pipe
#  flags=R user=scalemail argv=/usr/lib/scalemail/bin/scalemail-store
#  ${nexthop} ${user} ${extension}
#
#mailman   unix  -       n       n       -       -       pipe
#  flags=FRX user=list argv=/usr/lib/mailman/bin/postfix-to-mailman.py
#  ${nexthop} ${user}
smtps      inet    n       -       n       -       -     smtpd
  -o smtpd_tls_wrappermode=yes
  -o smtpd_sasl_auth_enable=yes
amavisfeed unix    -       -       n        -      2     lmtp
	   -o lmtp_data_done_timeout=1200
	   -o lmtp_send_xforward_command=yes
	   -o lmtp_tls_note_starttls_offer=no
127.0.0.1:10025 inet n    -       n       -        -     smtpd
     -o content_filter=
     -o smtpd_delay_reject=no
     -o smtpd_client_restrictions=permit_mynetworks,reject
     -o smtpd_helo_restrictions=
     -o smtpd_sender_restrictions=
     -o smtpd_recipient_restrictions=permit_mynetworks,reject
     -o smtpd_data_restrictions=reject_unauth_pipelining
     -o smtpd_end_of_data_restrictions=
     -o smtpd_restriction_classes=
     -o mynetworks=127.0.0.0/8
     -o smtpd_error_sleep_time=0
     -o smtpd_soft_error_limit=1001
     -o smtpd_hard_error_limit=1000
     -o smtpd_client_connection_count_limit=0
     -o smtpd_client_connection_rate_limit=0
     -o receive_override_options=no_header_body_checks,no_unknown_recipient_checks,no_milters
     -o local_header_rewrite_clients=
     -o smtpd_milters=
     -o local_recipient_maps=
     -o relay_recipient_maps=
     -o smtpd_tls_security_level=may
% sed -i  s/# @bypass_spam_checks_maps  = (1);/@bypass_spam_checks_maps  = (1);/g /usr/local/etc/amavisd.conf
% sed -i  s/# @storage_redis_dsn = ( {server=>'127.0.0.1:6379', db_id=>1} );/@storage_redis_dsn = ( {server=>'127.0.0.1:6379', db_id=>1} );/g /usr/local/etc/amavisd.conf
% sed -i  s/# $redis_logging_key/$redis_logging_key/g /usr/local/etc/amavisd.conf
% sed -i  s/# $redis_logging_queue_size_limit/$redis_logging_queue_size_limit/g /usr/local/etc/amavisd.conf
% cat /usr/local/etc/postfix/main.cf
# Global Postfix configuration file. This file lists only a subset
# of all parameters. For the syntax, and for a complete parameter
# list, see the postconf(5) manual page (command: "man 5 postconf").
#
# TIP: use the command "postconf -n" to view main.cf parameter
# settings, "postconf parametername" to view a specific parameter,
# and "postconf 'parametername=value'" to set a specific parameter.
#
# For common configuration examples, see BASIC_CONFIGURATION_README
# and STANDARD_CONFIGURATION_README. To find these documents, use
# the command "postconf html_directory readme_directory", or go to
# http://www.postfix.org/BASIC_CONFIGURATION_README.html etc.
#
# For best results, change no more than 2-3 parameters at a time,
# and test if Postfix still works after every change.

# COMPATIBILITY
#
# The compatibility_level determines what default settings Postfix
# will use for main.cf and master.cf settings. These defaults will
# change over time.
#
# To avoid breaking things, Postfix will use backwards-compatible
# default settings and log where it uses those old backwards-compatible
# default settings, until the system administrator has determined
# if any backwards-compatible default settings need to be made
# permanent in main.cf or master.cf.
#
# When this review is complete, update the compatibility_level setting
# below as recommended in the RELEASE_NOTES file.
#
# The level below is what should be used with new (not upgrade) installs.
#
compatibility_level = 3.9

# SOFT BOUNCE
#
# The soft_bounce parameter provides a limited safety net for
# testing.  When soft_bounce is enabled, mail will remain queued that
# would otherwise bounce. This parameter disables locally-generated
# bounces, and prevents the SMTP server from rejecting mail permanently
# (by changing 5xx replies into 4xx replies). However, soft_bounce
# is no cure for address rewriting mistakes or mail routing mistakes.
#
#soft_bounce = no

# LOCAL PATHNAME INFORMATION
#
# The queue_directory specifies the location of the Postfix queue.
# This is also the root directory of Postfix daemons that run chrooted.
# See the files in examples/chroot-setup for setting up Postfix chroot
# environments on different UNIX systems.
#
queue_directory = /var/spool/postfix

# The command_directory parameter specifies the location of all
# postXXX commands.
#
command_directory = /usr/local/sbin

# The daemon_directory parameter specifies the location of all Postfix
# daemon programs (i.e. programs listed in the master.cf file). This
# directory must be owned by root.
#
daemon_directory = /usr/local/libexec/postfix

# The data_directory parameter specifies the location of Postfix-writable
# data files (caches, random numbers). This directory must be owned
# by the mail_owner account (see below).
#
data_directory = /var/db/postfix

# QUEUE AND PROCESS OWNERSHIP
#
# The mail_owner parameter specifies the owner of the Postfix queue
# and of most Postfix daemon processes.  Specify the name of a user
# account THAT DOES NOT SHARE ITS USER OR GROUP ID WITH OTHER ACCOUNTS
# AND THAT OWNS NO OTHER FILES OR PROCESSES ON THE SYSTEM.  In
# particular, don't specify nobody or daemon. PLEASE USE A DEDICATED
# USER.
#
mail_owner = postfix

# The default_privs parameter specifies the default rights used by
# the local delivery agent for delivery to external file or command.
# These rights are used in the absence of a recipient user context.
# DO NOT SPECIFY A PRIVILEGED USER OR THE POSTFIX OWNER.
#
#default_privs = nobody

# INTERNET HOST AND DOMAIN NAMES
# 
# The myhostname parameter specifies the internet hostname of this
# mail system. The default is to use the fully-qualified domain name
# from gethostname(). $myhostname is used as a default value for many
# other configuration parameters.
#
myhostname = mail2.eurobsdcon.lab
#myhostname = virtual.domain.tld

# The mydomain parameter specifies the local internet domain name.
# The default is to use $myhostname minus the first component.
# $mydomain is used as a default value for many other configuration
# parameters.
#
mydomain = eurobsdcon.lab

# SENDING MAIL
# 
# The myorigin parameter specifies the domain that locally-posted
# mail appears to come from. The default is to append $myhostname,
# which is fine for small sites.  If you run a domain with multiple
# machines, you should (1) change this to $mydomain and (2) set up
# a domain-wide alias database that aliases each user to
# user@that.users.mailhost.
#
# For the sake of consistency between sender and recipient addresses,
# myorigin also specifies the default domain name that is appended
# to recipient addresses that have no @domain part.
#
#myorigin = $myhostname
#myorigin = $mydomain

# RECEIVING MAIL

# The inet_interfaces parameter specifies the network interface
# addresses that this mail system receives mail on.  By default,
# the software claims all active interfaces on the machine. The
# parameter also controls delivery of mail to user@[ip.address].
#
# See also the proxy_interfaces parameter, for network addresses that
# are forwarded to us via a proxy or network address translator.
#
# Note: you need to stop/start Postfix when this parameter changes.
#
#inet_interfaces = all
#inet_interfaces = $myhostname
#inet_interfaces = $myhostname, localhost

# The proxy_interfaces parameter specifies the network interface
# addresses that this mail system receives mail on by way of a
# proxy or network address translation unit. This setting extends
# the address list specified with the inet_interfaces parameter.
#
# You must specify your proxy/NAT addresses when your system is a
# backup MX host for other domains, otherwise mail delivery loops
# will happen when the primary MX host is down.
#
#proxy_interfaces =
#proxy_interfaces = 1.2.3.4

# The mydestination parameter specifies the list of domains that this
# machine considers itself the final destination for.
#
# These domains are routed to the delivery agent specified with the
# local_transport parameter setting. By default, that is the UNIX
# compatible delivery agent that lookups all recipients in /etc/passwd
# and /etc/aliases or their equivalent.
#
# The default is $myhostname + localhost.$mydomain + localhost.  On
# a mail domain gateway, you should also include $mydomain.
#
# Do not specify the names of virtual domains - those domains are
# specified elsewhere (see VIRTUAL_README).
#
# Do not specify the names of domains that this machine is backup MX
# host for. Specify those names via the relay_domains settings for
# the SMTP server, or use permit_mx_backup if you are lazy (see
# STANDARD_CONFIGURATION_README).
#
# The local machine is always the final destination for mail addressed
# to user@[the.net.work.address] of an interface that the mail system
# receives mail on (see the inet_interfaces parameter).
#
# Specify a list of host or domain names, /file/name or type:table
# patterns, separated by commas and/or whitespace. A /file/name
# pattern is replaced by its contents; a type:table is matched when
# a name matches a lookup key (the right-hand side is ignored).
# Continue long lines by starting the next line with whitespace.
#
# See also below, section "REJECTING MAIL FOR UNKNOWN LOCAL USERS".
#
#mydestination = $myhostname, localhost.$mydomain, localhost
#mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
#mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain,
#	mail.$mydomain, www.$mydomain, ftp.$mydomain

# REJECTING MAIL FOR UNKNOWN LOCAL USERS
#
# The local_recipient_maps parameter specifies optional lookup tables
# with all names or addresses of users that are local with respect
# to $mydestination, $inet_interfaces or $proxy_interfaces.
#
# If this parameter is defined, then the SMTP server will reject
# mail for unknown local users. This parameter is defined by default.
#
# To turn off local recipient checking in the SMTP server, specify
# local_recipient_maps = (i.e. empty).
#
# The default setting assumes that you use the default Postfix local
# delivery agent for local delivery. You need to update the
# local_recipient_maps setting if:
#
# - You define $mydestination domain recipients in files other than
#   /etc/passwd, /etc/aliases, or the $virtual_alias_maps files.
#   For example, you define $mydestination domain recipients in    
#   the $virtual_mailbox_maps files.
#
# - You redefine the local delivery agent in master.cf.
#
# - You redefine the "local_transport" setting in main.cf.
#
# - You use the "luser_relay", "mailbox_transport", or "fallback_transport"
#   feature of the Postfix local delivery agent (see local(8)).
#
# Details are described in the LOCAL_RECIPIENT_README file.
#
# Beware: if the Postfix SMTP server runs chrooted, you probably have
# to access the passwd file via the proxymap service, in order to
# overcome chroot restrictions. The alternative, having a copy of
# the system passwd file in the chroot jail is just not practical.
#
# The right-hand side of the lookup tables is conveniently ignored.
# In the left-hand side, specify a bare username, an @domain.tld
# wild-card, or specify a user@domain.tld address.
# 
local_recipient_maps = unix:passwd.byname $alias_maps
#local_recipient_maps = proxy:unix:passwd.byname $alias_maps
#local_recipient_maps =

# The unknown_local_recipient_reject_code specifies the SMTP server
# response code when a recipient domain matches $mydestination or
# ${proxy,inet}_interfaces, while $local_recipient_maps is non-empty
# and the recipient address or address local-part is not found.
#
# The default setting is 550 (reject mail) but it is safer to start
# with 450 (try again later) until you are certain that your
# local_recipient_maps settings are OK.
#
unknown_local_recipient_reject_code = 550

# TRUST AND RELAY CONTROL

# The mynetworks parameter specifies the list of "trusted" SMTP
# clients that have more privileges than "strangers".
#
# In particular, "trusted" SMTP clients are allowed to relay mail
# through Postfix.  See the smtpd_recipient_restrictions parameter
# in postconf(5).
#
# You can specify the list of "trusted" network addresses by hand
# or you can let Postfix do it for you (which is the default).
#
# By default (mynetworks_style = host), Postfix "trusts" only
# the local machine.
# 
# Specify "mynetworks_style = subnet" when Postfix should "trust"
# SMTP clients in the same IP subnetworks as the local machine.
# On Linux, this works correctly only with interfaces specified
# with the "ifconfig" or "ip" command.
#
# Specify "mynetworks_style = class" when Postfix should "trust" SMTP
# clients in the same IP class A/B/C networks as the local machine.
# Don't do this with a dialup site - it would cause Postfix to "trust"
# your entire provider's network.  Instead, specify an explicit
# mynetworks list by hand, as described below.
#  
# Specify "mynetworks_style = host" when Postfix should "trust"
# only the local machine.
# 
#mynetworks_style = class
#mynetworks_style = subnet
mynetworks_style = host

# Alternatively, you can specify the mynetworks list by hand, in
# which case Postfix ignores the mynetworks_style setting.
#
# Specify an explicit list of network/netmask patterns, where the
# mask specifies the number of bits in the network part of a host
# address.
#
# You can also specify the absolute pathname of a pattern file instead
# of listing the patterns here. Specify type:table for table-based lookups
# (the value on the table right-hand side is not used).
#
mynetworks = 10.193.167.0/24
#mynetworks = $config_directory/mynetworks
#mynetworks = hash:$config_directory/network_table

# The relay_domains parameter restricts what destinations this system will
# relay mail to.  See the smtpd_relay_restrictions and
# smtpd_recipient_restrictions descriptions in  postconf(5) for detailed
# information.
#
# By default, Postfix relays mail
# - from "trusted" clients (IP address matches $mynetworks, or is
#   SASL authenticated) to any destination,
# - from "untrusted" clients to destinations that match $relay_domains or
#   subdomains thereof, except addresses with sender-specified routing.
# The default relay_domains value is empty.
# 
# In addition to the above, the Postfix SMTP server by default accepts mail
# that Postfix is final destination for:
# - destinations that match $inet_interfaces or $proxy_interfaces,
# - destinations that match $mydestination
# - destinations that match $virtual_alias_domains,
# - destinations that match $virtual_mailbox_domains.
# These destinations do not need to be listed in $relay_domains.
# 
# Specify a list of hosts or domains, /file/name patterns or type:name
# lookup tables, separated by commas and/or whitespace.  Continue
# long lines by starting the next line with whitespace. A file name
# is replaced by its contents; a type:name table is matched when a
# (parent) domain appears as lookup key.
#
# NOTE: Postfix will not automatically forward mail for domains that
# list this system as their primary or backup MX host. See the
# permit_mx_backup restriction description in postconf(5).
#
#relay_domains = 

# INTERNET OR INTRANET

# The relayhost parameter specifies the default host to send mail to
# when no entry is matched in the optional transport(5) table. When
# no relayhost is given, mail is routed directly to the destination.
#
# On an intranet, specify the organizational domain name. If your
# internal DNS uses no MX records, specify the name of the intranet
# gateway host instead.
#
# In the case of SMTP, specify a domain, host, host:port, [host]:port,
# [address] or [address]:port; the form [host] turns off MX lookups.
#
# If you're connected via UUCP, see also the default_transport parameter.
#
#relayhost = $mydomain
#relayhost = [gateway.my.domain]
#relayhost = [mailserver.isp.tld]
#relayhost = uucphost
#relayhost = [an.ip.add.ress]

# REJECTING UNKNOWN RELAY USERS
#
# The relay_recipient_maps parameter specifies optional lookup tables
# with all addresses in the domains that match $relay_domains.
#
# If this parameter is defined, then the SMTP server will reject
# mail for unknown relay users. This feature is off by default.
#
# The right-hand side of the lookup tables is conveniently ignored.
# In the left-hand side, specify an @domain.tld wild-card, or specify
# a user@domain.tld address.
# 
#relay_recipient_maps = hash:$config_directory/relay_recipients

# INPUT RATE CONTROL
#
# The in_flow_delay configuration parameter implements mail input
# flow control. This feature is turned on by default, although it
# still needs further development (it's disabled on SCO UNIX due
# to an SCO bug).
# 
# A Postfix process will pause for $in_flow_delay seconds before
# accepting a new message, when the message arrival rate exceeds the
# message delivery rate. With the default 100 SMTP server process
# limit, this limits the mail inflow to 100 messages a second more
# than the number of messages delivered per second.
# 
# Specify 0 to disable the feature. Valid delays are 0..10.
# 
#in_flow_delay = 1s

# ADDRESS REWRITING
#
# The ADDRESS_REWRITING_README document gives information about
# address masquerading or other forms of address rewriting including
# username->Firstname.Lastname mapping.

# ADDRESS REDIRECTION (VIRTUAL DOMAIN)
#
# The VIRTUAL_README document gives information about the many forms
# of domain hosting that Postfix supports.

# "USER HAS MOVED" BOUNCE MESSAGES
#
# See the discussion in the ADDRESS_REWRITING_README document.

# TRANSPORT MAP
#
# See the discussion in the ADDRESS_REWRITING_README document.

# ALIAS DATABASE
#
# The alias_maps parameter specifies the list of alias databases used
# by the local delivery agent. The default list is system dependent.
#
# On systems with NIS, the default is to search the local alias
# database, then the NIS alias database. See aliases(5) for syntax
# details.
# 
# If you change the alias database, run "postalias /etc/aliases" (or
# wherever your system stores the mail alias file), or simply run
# "newaliases" to build the necessary DBM or DB file.
#
# It will take a minute or so before changes become visible.  Use
# "postfix reload" to eliminate the delay.
#
#alias_maps = dbm:/etc/aliases
#alias_maps = hash:/etc/aliases
#alias_maps = hash:/etc/aliases, nis:mail.aliases
#alias_maps = netinfo:/aliases

# The alias_database parameter specifies the alias database(s) that
# are built with "newaliases" or "sendmail -bi".  This is a separate
# configuration parameter, because alias_maps (see above) may specify
# tables that are not necessarily all under control by Postfix.
#
#alias_database = dbm:/etc/aliases
#alias_database = hash:/etc/aliases
#alias_database = hash:/etc/aliases, hash:/opt/majordomo/aliases

# ADDRESS EXTENSIONS (e.g., user+foo)
#
# The recipient_delimiter parameter specifies the separator between
# user names and address extensions (user+foo). See canonical(5),
# local(8), relocated(5) and virtual(5) for the effects this has on
# aliases, canonical, virtual, relocated and .forward file lookups.
# Basically, the software tries user+foo and .forward+foo before
# trying user and .forward.
#
#recipient_delimiter = +

# DELIVERY TO MAILBOX
#
# The home_mailbox parameter specifies the optional pathname of a
# mailbox file relative to a user's home directory. The default
# mailbox file is /var/spool/mail/user or /var/mail/user.  Specify
# "Maildir/" for qmail-style delivery (the / is required).
#
#home_mailbox = Mailbox
#home_mailbox = Maildir/
 
# The mail_spool_directory parameter specifies the directory where
# UNIX-style mailboxes are kept. The default setting depends on the
# system type.
#
#mail_spool_directory = /var/mail
#mail_spool_directory = /var/spool/mail

# The mailbox_command parameter specifies the optional external
# command to use instead of mailbox delivery. The command is run as
# the recipient with proper HOME, SHELL and LOGNAME environment settings.
# Exception:  delivery for root is done as $default_privs.
#
# Other environment variables of interest: USER (recipient username),
# EXTENSION (address extension), DOMAIN (domain part of address),
# and LOCAL (the address localpart).
#
# Unlike other Postfix configuration parameters, the mailbox_command
# parameter is not subjected to $parameter substitutions. This is to
# make it easier to specify shell syntax (see example below).
#
# Avoid shell meta characters because they will force Postfix to run
# an expensive shell process. Procmail alone is expensive enough.
#
# IF YOU USE THIS TO DELIVER MAIL SYSTEM-WIDE, YOU MUST SET UP AN
# ALIAS THAT FORWARDS MAIL FOR ROOT TO A REAL USER.
#
#mailbox_command = /some/where/procmail
#mailbox_command = /some/where/procmail -a "$EXTENSION"

# The mailbox_transport specifies the optional transport in master.cf
# to use after processing aliases and .forward files. This parameter
# has precedence over the mailbox_command, fallback_transport and
# luser_relay parameters.
#
# Specify a string of the form transport:nexthop, where transport is
# the name of a mail delivery transport defined in master.cf.  The
# :nexthop part is optional. For more details see the sample transport
# configuration file.
#
# NOTE: if you use this feature for accounts not in the UNIX password
# file, then you must update the "local_recipient_maps" setting in
# the main.cf file, otherwise the SMTP server will reject mail for    
# non-UNIX accounts with "User unknown in local recipient table".
#
# Cyrus IMAP over LMTP. Specify ``lmtpunix      cmd="lmtpd"
# listen="/var/imap/socket/lmtp" prefork=0'' in cyrus.conf.
mailbox_transport = lmtp:unix:/var/imap/socket/lmtp
#
# Cyrus IMAP via command line. Uncomment the "cyrus...pipe" and
# subsequent line in master.cf.
#mailbox_transport = cyrus

# The fallback_transport specifies the optional transport in master.cf
# to use for recipients that are not found in the UNIX passwd database.
# This parameter has precedence over the luser_relay parameter.
#
# Specify a string of the form transport:nexthop, where transport is
# the name of a mail delivery transport defined in master.cf.  The
# :nexthop part is optional. For more details see the sample transport
# configuration file.
#
# NOTE: if you use this feature for accounts not in the UNIX password
# file, then you must update the "local_recipient_maps" setting in
# the main.cf file, otherwise the SMTP server will reject mail for    
# non-UNIX accounts with "User unknown in local recipient table".
#
#fallback_transport = lmtp:unix:/file/name
#fallback_transport = cyrus
#fallback_transport =

# The luser_relay parameter specifies an optional destination address
# for unknown recipients.  By default, mail for unknown@$mydestination,
# unknown@[$inet_interfaces] or unknown@[$proxy_interfaces] is returned
# as undeliverable.
#
# The following expansions are done on luser_relay: $user (recipient
# username), $shell (recipient shell), $home (recipient home directory),
# $recipient (full recipient address), $extension (recipient address
# extension), $domain (recipient domain), $local (entire recipient
# localpart), $recipient_delimiter. Specify ${name?value} or
# ${name:value} to expand value only when $name does (does not) exist.
#
# luser_relay works only for the default Postfix local delivery agent.
#
# NOTE: if you use this feature for accounts not in the UNIX password
# file, then you must specify "local_recipient_maps =" (i.e. empty) in
# the main.cf file, otherwise the SMTP server will reject mail for    
# non-UNIX accounts with "User unknown in local recipient table".
#
#luser_relay = $user@other.host
#luser_relay = $local@other.host
#luser_relay = admin+$local
  
# JUNK MAIL CONTROLS
# 
# The controls listed here are only a very small subset. The file
# SMTPD_ACCESS_README provides an overview.

# The header_checks parameter specifies an optional table with patterns
# that each logical message header is matched against, including
# headers that span multiple physical lines.
#
# By default, these patterns also apply to MIME headers and to the
# headers of attached messages. With older Postfix versions, MIME and
# attached message headers were treated as body text.
#
# For details, see "man header_checks".
#
#header_checks = regexp:$config_directory/header_checks

# FAST ETRN SERVICE
#
# Postfix maintains per-destination logfiles with information about
# deferred mail, so that mail can be flushed quickly with the SMTP
# "ETRN domain.tld" command, or by executing "sendmail -qRdomain.tld".
# See the ETRN_README document for a detailed description.
# 
# The fast_flush_domains parameter controls what destinations are
# eligible for this service. By default, they are all domains that
# this server is willing to relay mail to.
# 
#fast_flush_domains = $relay_domains

# SHOW SOFTWARE VERSION OR NOT
#
# The smtpd_banner parameter specifies the text that follows the 220
# code in the SMTP server's greeting banner. Some people like to see
# the mail version advertised. By default, Postfix shows no version.
#
# You MUST specify $myhostname at the start of the text. That is an
# RFC requirement. Postfix itself does not care.
#
#smtpd_banner = $myhostname ESMTP $mail_name
#smtpd_banner = $myhostname ESMTP $mail_name ($mail_version)

# PARALLEL DELIVERY TO THE SAME DESTINATION
#
# How many parallel deliveries to the same user or domain? With local
# delivery, it does not make sense to do massively parallel delivery
# to the same user, because mailbox updates must happen sequentially,
# and expensive pipelines in .forward files can cause disasters when
# too many are run at the same time. With SMTP deliveries, 10
# simultaneous connections to the same domain could be sufficient to
# raise eyebrows.
# 
# Each message delivery transport has its XXX_destination_concurrency_limit
# parameter.  The default is $default_destination_concurrency_limit for
# most delivery transports. For the local delivery agent the default is 2.

#local_destination_concurrency_limit = 2
#default_destination_concurrency_limit = 20

# DEBUGGING CONTROL
#
# The debug_peer_level parameter specifies the increment in verbose
# logging level when an SMTP client or server host name or address
# matches a pattern in the debug_peer_list parameter.
#
debug_peer_level = 2

# The debug_peer_list parameter specifies an optional list of domain
# or network patterns, /file/name patterns or type:name tables. When
# an SMTP client or server host name or address matches a pattern,
# increase the verbose logging level by the amount specified in the
# debug_peer_level parameter.
#
#debug_peer_list = 127.0.0.1
#debug_peer_list = some.domain

# The debugger_command specifies the external command that is executed
# when a Postfix daemon program is run with the -D option.
#
# Use "command .. & sleep 5" so that the debugger can attach before
# the process marches on. If you use an X-based debugger, be sure to
# set up your XAUTHORITY environment variable before starting Postfix.
#
debugger_command =
	 PATH=/bin:/usr/bin:/usr/local/bin:/usr/X11R6/bin
	 ddd $daemon_directory/$process_name $process_id & sleep 5

# If you can't use X, use this to capture the call stack when a
# daemon crashes. The result is in a file in the configuration
# directory, and is named after the process name and the process ID.
#
# debugger_command =
#	PATH=/bin:/usr/bin:/usr/local/bin; export PATH; (echo cont;
#	echo where) | gdb $daemon_directory/$process_name $process_id 2>&1
#	>$config_directory/$process_name.$process_id.log & sleep 5
#
# Another possibility is to run gdb under a detached screen session.
# To attach to the screen session, su root and run "screen -r
# <id_string>" where <id_string> uniquely matches one of the detached
# sessions (from "screen -list").
#
# debugger_command =
#	PATH=/bin:/usr/bin:/sbin:/usr/sbin; export PATH; screen
#	-dmS $process_name gdb $daemon_directory/$process_name
#	$process_id & sleep 1

# INSTALL-TIME CONFIGURATION INFORMATION
#
# The following parameters are used when installing a new Postfix version.
# 
# sendmail_path: The full pathname of the Postfix sendmail command.
# This is the Sendmail-compatible mail posting interface.
# 
sendmail_path = /usr/local/sbin/sendmail

# newaliases_path: The full pathname of the Postfix newaliases command.
# This is the Sendmail-compatible command to build alias databases.
#
newaliases_path = /usr/local/bin/newaliases

# mailq_path: The full pathname of the Postfix mailq command.  This
# is the Sendmail-compatible mail queue listing command.
# 
mailq_path = /usr/local/bin/mailq

# setgid_group: The group for mail submission and queue management
# commands.  This must be a group name with a numerical group ID that
# is not shared with other accounts, not even with the Postfix account.
#
setgid_group = maildrop

# html_directory: The location of the Postfix HTML documentation.
#
html_directory = /usr/local/share/doc/postfix

# manpage_directory: The location of the Postfix on-line manual pages.
#
manpage_directory = /usr/local/share/man

# sample_directory: The location of the Postfix sample configuration files.
# This parameter is obsolete as of Postfix 2.1.
#
sample_directory = /usr/local/etc/postfix

# readme_directory: The location of the Postfix README files.
#
readme_directory = /usr/local/share/doc/postfix
inet_protocols = all

# smtp CA path (default to system-wide location)
smtp_tls_CApath = /etc/ssl/certs
meta_directory = /usr/local/libexec/postfix
shlib_directory = /usr/local/lib/postfix
smtpd_tls_CAfile = /usr/local/etc/ssl/ca.crt
smtpd_tls_cert_file = /usr/local/etc/ssl/server.crt
smtpd_tls_key_file = /usr/local/etc/ssl/server.key
smtpd_tls_security_level = may
smtpd_tls_auth_only = yes

# virtual delivery configuration
virtual_mailbox_domains = eurobsdcon.lab
virtual_transport = lmtp:unix:/var/imap/socket/lmtp
virtual_mailbox_maps = hash:/usr/local/etc/postfix/vmailbox
virtual_alias_maps = hash:/usr/local/etc/postfix/virtualmap
smtpd_recipient_restrictions =
        permit_sasl_authenticated,
        reject_rbl_client bl.spamcop.net,
        reject_rbl_client dnsbl.sorbs.net,
        reject_unauth_pipelining,
        reject_invalid_hostname,
        reject_non_fqdn_sender,
        reject_non_fqdn_recipient,
        reject_unknown_sender_domain,
        reject_unknown_recipient_domain,
        permit

milter_default_action = accept
milter_protocol = 6
smtpd_milters     = local:/var/run/amavis/amavisd-milter.sock,local:/var/run/spamass-milter.sock,inet:localhost:10999
#smtpd_milters    = inet:localhost:10999
non_smtpd_milters = inet:localhost:10999

smtpd_tls_mandatory_protocols = TLSv1.1 TLSv1.2 TLSv1.3
smtpd_tls_protocols = TLSv1.1 TLSv1.2 TLSv1.3

# Configure the allowed cipher list
smtpd_tls_mandatory_ciphers=high

tls_high_cipherlist = kEECDH:+kEECDH+SHA:kEDH:+kEDH+SHA:+kEDH+CAMELLIA:kECDH:+kECDH+SHA:kRSA:+kRSA+SHA:+kRSA+CAMELLIA:!aNULL:!eNULL:!SSLv2:!RC4:!MD5:!DES:!EXP:!SEED:!IDEA:!3DES
tls_medium_cipherlist = kEECDH:+kEECDH+SHA:kEDH:+kEDH+SHA:+kEDH+CAMELLIA:kECDH:+kECDH+SHA:kRSA:+kRSA+SHA:+kRSA+CAMELLIA:!aNULL:!eNULL:!SSLv2:!MD5:!DES:!EXP:!SEED:!IDEA:!3DES

smtp_tls_ciphers = high
smtpd_tls_ciphers = high

disable_vrfy_command=yes
smtpd_helo_required=yes

smtpd_sasl_local_domain=mail2
% sed -i  s@# $myhostname = 'host.example.com'@$myhostname = 'mail2.eurobsdcon.lab.eurobsdcon.lab'@g /usr/local/etc/amavisd.conf
% sed -i  s@example.com@eurobsdcon.lab@g /usr/local/etc/amavisd.conf
% service amavisd start
Starting amavisd.
% service amavisd-milter enable
amavisd_milter enabled in /etc/rc.conf
% service amavisd-milter start
Starting amavisd_milter.
% service postfix restart
% cat /etc/pf.conf
ext_if = "vtnet0"
table <sshguard> {}
table <spamd-white> persist file "/etc/pf.spamdwhite"

# allow white list to go directly to smtps and smtp
# rdr pass inet proto tcp from <spamd-white> to any port 465 -> 127.0.0.1 port 466
#no rdr inet proto tcp from <spamd-white> to any #      port smtp
#rdr pass inet proto tcp from any to any #      port smtp -> 127.0.0.1 port spamd

set skip on lo0

MAILHOSTS = "{ 10.193.167.0/24 }"
pass in log on $ext_if inet proto tcp to $MAILHOSTS      port smtp
pass out log on $ext_if inet proto tcp from $MAILHOSTS      to any port smtp

block from <sshguard>
block in inet proto tcp from any to any port 4190
# no pop3
block in inet proto tcp from any to any port 110
% sysrc pf_enable=YES
pf_enable: NO -> YES
% echo 10.193.167.0/24 >> /etc/pf.spamdwhite
% sed -i  s@#BACKEND="/usr/local/libexec/sshg-fw-pf"@BACKEND="/usr/local/libexec/sshg-fw-pf"@g /usr/local/etc/sshguard.conf
% sed -i  s@#PID_FILE=/var/run/sshguard.pid@PID_FILE=/var/run/sshguard.pid@g /usr/local/etc/sshguard.conf
% sed -i  s@#BLACKLIST_FILE=120:/var/db/sshguard/blacklist.db@BLACKLIST_FILE=120:/var/db/sshguard/blacklist.db@g /usr/local/etc/sshguard.conf
% mkdir -p /var/db/sshguard
% touch /var/db/sshguard/blacklist.db
% service sshguard enable
sshguard enabled in /etc/rc.conf
% service sshguard start
Starting sshguard.
% /usr/local/sbin/add-spamd-to-etc-service
Checking /etc/services for missing spamd service entries
==> add entry "spamd 8025/tcp"
==> add entry "spamd-sync 8025/udp"
==> add entry "spamd-cfg 8026/tcp"
% cat /usr/local/etc/spamd/spamd.alloweddomains
@eurobsdcon.lab
% sysrc obspamd_enable=YES
obspamd_enable:  -> YES
% sysrc obspamlogd_enable=YES
obspamlogd_enable:  -> YES
% cp /usr/local/etc/spamd/spamd.conf.sample /usr/local/etc/spamd.conf
% echo fdescfs         /dev/fd         fdescfs rw      0       0 >> /etc/fstab
% mount -a
% sysrc pflog_enable=YES
pflog_enable: NO -> YES
% service pf start
Enabling pf.
% service pflog start
Starting pflog.
% service obspamd start
Starting obspamd.
% service obspamlogd start
Starting obspamlogd.
% pw useradd opendkim -s /usr/sbin/nologin
% mkdir -p /usr/local/etc/opendkim
% sed -i '' "s@Domain[\t ]*example.com@Domain eurobsdcon.lab@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@KeyFile[\t ]*/var/db/dkim/example.private@#KeyFile /var/db/dkim/example.private\
KeyTable refile:/usr/local/etc/opendkim/keytable@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@# LogWhy[\t ]*no@LogWhy yes@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@# MultipleSignatures[\t ]*no@MultipleSignatures    yes@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@# Nameservers addr1,addr2,...@Nameservers 10.193.167.10@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@# RedirectFailuresTo[\t ]*postmaster\@example.com@# RedirectFailuresTo    postmaster\@eurobsdcon.lab@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@# ReportAddress[\t ]*"DKIM Error Postmaster" \<postmaster\@example.com\>@# ReportAddress \"DKIM Error Postmaster\" \<postmaster\@eurobsdcon.lab\>@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@Selector[\t ]*my-selector-name@Selector _default@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@# SigningTable[\t ]*filename@# SigningTable          filename\
SigningTable refile:/usr/local/etc/opendkim/signingtable@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@Socket[\t ]*inet:port\@localhost@Socket inet:10999\@localhost@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@# SoftwareHeader[\t ]*no@# SoftwareHeader yes@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@# SyslogSuccess[\t ]*No@SyslogSuccess yes@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@# UserID[\t ]*userid@# UserID opendkim:opendkim@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@# RequireSafeKeys[\t ]*Yes@RequireSafeKeys No@g" /usr/local/etc/mail/opendkim.conf
% sed -i '' "s@# Mode[\t ]*sv@Mode sv@g" /usr/local/etc/mail/opendkim.conf
 // Install for DNS:
_default._domainkey	IN	TXT	( "v=DKIM1; k=rsa; "
	  "p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4N+7XSAg63nK8kKdYn09brl5DZsgMs05wa0A0nCQKPFakkXu9+9UHyOpwCGWAQZ4YnGhBdF1y30l7rFxG6YEJRXCEfLqo/yxReMztnbfja69gf2LCX0RL/PpekFd6R2/XIv1gHhH1wd6ffCuKfe3lfSWHZvYFgFgd5SsK1N2ohyn2UtP/HT1w4q0SOmsuLVWLXXvTEPIzyHV6d"
	  "UimV3G+z2s5cS7J84d0hv5nPdMCFVn5bi+4M5IgEVQSs/Lw6K5C2kLjyvn1GjbY/dLPwP9ZVOrgKAcLKOl9MkS59cpwKOT7Re1Pdoo07LW9BgcW7xqA1Ijr3LCEybjN0JeA6OXTwIDAQAB" )  ; ----- DKIM key _default for eurobsdcon.lab
% echo "*@eurobsdcon.lab eurobsdcon.lab" \> /usr/local/etc/opendkim/signingtable
% echo "eurobsdcon.lab eurobsdcon.lab:_default:/usr/local/etc/opendkim/eurobsdcon.lab.private" \> /usr/local/etc/opendkim/keytable
% chown mailnull /usr/local/etc/opendkim/eurobsdcon.lab.private
% service milter-opendkim enable
milteropendkim enabled in /etc/rc.conf
% service milter-opendkim start
Starting milteropendkim.
 // Setup completed.
